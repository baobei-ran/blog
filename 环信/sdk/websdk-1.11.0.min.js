!function (e, t) { "object" == typeof exports && "object" == typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : "object" == typeof exports ? exports.WebIM = t() : e.WebIM = t() }(this, function () {
    return function (e) { function t(r) { if (n[r]) return n[r].exports; var o = n[r] = { exports: {}, id: r, loaded: !1 }; return e[r].call(o.exports, o, o.exports, t), o.loaded = !0, o.exports } var n = {}; return t.m = e, t.c = n, t.p = "", t(0) }([function (e, t, n) { e.exports = n(1) }, function (module, exports, __webpack_require__) {
        function _parsePrivacy(e) { var t = {}, n = e.getElementsByTagName("item"); if (n) for (var r = 0; r < n.length; r++) { var o = n[r], i = o.getAttribute("value"), s = o.getAttribute("order"), a = o.getAttribute("type"); if (i) { var c = _parseNameFromJidFn(i); t[c] = { type: a, order: s, jid: i, name: c } } } return t } function _parseGroupBlacklist(e) { var t = {}, n = e.getElementsByTagName("item"); if (n) for (var r = 0; r < n.length; r++) { var o = n[r], i = o.getAttribute("jid"), s = o.getAttribute("affiliation"), a = o.getAttribute("nick"); if (i) { var c = _parseNameFromJidFn(i); t[c] = { jid: i, affiliation: s, nick: a, name: c } } } return t } function _setText(e, t) { "textContent" in e ? e.textContent = t : "text" in e && (e.text = t) } var _version = "1.4.13", Strophe = __webpack_require__(2).Strophe, meStrophe = __webpack_require__(2), _code = __webpack_require__(7).code, _utils = __webpack_require__(8).utils, _msg = __webpack_require__(9), _message = _msg._msg, _msgHash = {}, Queue = __webpack_require__(44).Queue, CryptoJS = __webpack_require__(10), _ = __webpack_require__(45), isStropheLog, stropheConn = Strophe.Connection; $iq = meStrophe.$iq, $build = meStrophe.$build, $msg = meStrophe.$msg, $pres = meStrophe.$pres, window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL; var logMessage = function (e) { }; window.XDomainRequest, Strophe.Request.prototype._newXHR = function () { var e = _utils.xmlrequest(!0); return e.overrideMimeType && e.overrideMimeType("text/xml"), e.onreadystatechange = this.func.bind(null, this), e }, Strophe.Websocket.prototype._closeSocket = function () { if (this.socket) { var e = this; setTimeout(function () { try { e.socket.close() } catch (e) { } }, 0) } else this.socket = null }, Strophe.log = function (e, t) { if (isStropheLog) switch (e) { case this.LogLevel.DEBUG: console.debug(t); break; case this.LogLevel.INFO: console.info(t); break; case this.LogLevel.WARN: console.warn(t); break; case this.LogLevel.ERROR: case this.LogLevel.FATAL: console.error(t); break; default: console.log(t) } }, Strophe.Websocket.prototype._onMessage = function (e) { logMessage(e); var t = e.data; if (t.indexOf("<jid>") > 0) { var n = t.indexOf("<jid>"), r = t.indexOf("</jid>"), t = t.substring(n + 5, r);"function"==typeof stropheConn.setJid?stropheConn.setJid(t):stropheConn.setJid=function(e){this.jid=e,this.authzid=Strophe.getBareJidFromJid(this.jid),this.authcid=Strophe.getNodeFromJid(this.jid)}}var o,t;if(0===e.data.indexOf("<close ")){o=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;var i=o.getAttribute("see-other-uri");return void(i?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect()):this._conn._doDisconnect("receive <close> from server"))}if(0===e.data.search("<open ")){if(o=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(o))return}else t=this._streamWrap(e.data),o=(new DOMParser).parseFromString(t,"text/xml").documentElement;if(!this._check_streamerror(o,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===o.firstChild.nodeName&&"unavailable"===o.firstChild.getAttribute("type")?(this._conn.xmlInput(o),void this._conn.rawInput(Strophe.serialize(o))):void this._conn._dataRecv(o,e.data)};var _listenNetwork=function(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)}))},_parseRoom=function(e){var t=[],n=e.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var o=n[r],i=o.getAttribute("jid"),s=i.split("@")[0],a={jid:i,name:o.getAttribute("name"),roomId:s.split("_")[1]};t.push(a)}return t},_parseRoomOccupants=function(e){var t=[],n=e.getElementsByTagName("item");if(n)for(var r=0;r<n.length;r++){var o=n[r],i={jid:o.getAttribute("jid"),name:o.getAttribute("name")};t.push(i)}return t},_parseResponseMessage=function(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}return parseMsgData},_parseNameFromJidFn=function(e,t){t=t||"";var n=e,r=n.indexOf("_");-1!==r&&(n=n.substring(r+1));var o=n.indexOf("@"+t);return-1!==o&&(n=n.substring(0,o)),n},_parseFriend=function(e,t,n){var r=[],o=e.getElementsByTagName("item");if(o)for(var i=0;i<o.length;i++){var s=o[i],a=s.getAttribute("jid");if(a){var c=s.getAttribute("subscription"),u={subscription:c,jid:a},l=s.getAttribute("ask");l&&(u.ask=l);var h=s.getAttribute("name");if(h)u.name=h;else{var d=_parseNameFromJidFn(a);u.name=d}var p=[];Strophe.forEachChild(s,"group",function(e){p.push(Strophe.getText(e))}),u.groups=p,r.push(u),t&&"from"==c&&!l&&t.subscribe({toJid:a,message:"[resp:true]"}),t&&"to"==c&&t.subscribed({toJid:a})}}return r},_login=function(e,t){if(e){var n=e.access_token||"";if(""==n){_utils.stringify(e);return void t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e})}t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in,stropheConn=t.isOpening()&&t.context.stropheConn?t.getStrophe():(t.isOpened()&&t.context.stropheConn,t.getStrophe());var r=function(e,n){_loginCallback(e,n,t)};t.context.stropheConn=stropheConn,t.route?stropheConn.connect(t.context.jid,"$t$"+n,r,t.wait,t.hold,t.route):stropheConn.connect(t.context.jid,"$t$"+n,r,t.wait,t.hold)}},_parseMessageType=function(e){var t=e.getElementsByTagName("received"),n=e.getElementsByTagName("invite"),r=e.getElementsByTagName("delivery"),o=e.getElementsByTagName("acked"),i=e.getElementsByTagName("error"),s="normal";if(t&&t.length>0&&"urn:xmpp:receipts"===t[0].namespaceURI)s="received";else if(n&&n.length>0)s="invite";else if(r&&r.length>0)s="delivery";else if(o&&o.length)s="acked";else if(i&&i.length){var a=i[0],c=a.getElementsByTagName("user-muted");c&&c.length&&(s="userMuted")}return s},_handleMessageQueue=function(e){for(var t in _msgHash)_msgHash.hasOwnProperty(t)&&_msgHash[t].send(e)},_loginCallback=function(e,t,n){var r,o;if("conflict"===t&&(r=!0,n.close()),e==Strophe.Status.CONNFAIL)o={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},r&&(o.conflict=!0),n.onError(o);else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){n.autoReconnectNumTotal=0,n.intervalId=setInterval(function(){n.handelSendQueue()},100);var i=function(e){var t=e.getElementsByTagName("delivery"),r=e.getElementsByTagName("acked");if(t.length)return n.handleDeliveredMessage(e),!0;if(r.length)return n.handleAckedMessage(e),!0;switch(_parseMessageType(e)){case"received":return n.handleReceivedMessage(e),!0;case"invite":return n.handleInviteMessage(e),!0;case"delivery":return n.handleDeliveredMessage(e),!0;case"acked":return n.handleAckedMessage(e),!0;case"userMuted":return n.handleMutedMessage(e),!0;default:return n.handleMessage(e),!0}},s=function(e){return n.handlePresence(e),!0},a=function(e){return n.handlePing(e),!0},c=function(e){return n.handleIqRoster(e),!0},u=function(e){return n.handleIqPrivacy(e),!0},l=function(e){return n.handleIq(e),!0};n.addHandler(i,null,"message",null,null,null),n.addHandler(s,null,"presence",null,null,null),n.addHandler(a,"urn:xmpp:ping","iq","get",null,null),n.addHandler(c,"jabber:iq:roster","iq","set",null,null),n.addHandler(u,"jabber:iq:privacy","iq","set",null,null),n.addHandler(l,null,"iq",null,null,null),n.registerConfrIQHandler&&n.registerConfrIQHandler(),n.context.status=_code.STATUS_OPENED;var h=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(h.push(_code.WEBIM_MESSAGE_REC_PHOTO),h.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var d=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(d.push(_code.WEBIM_MESSAGE_REC_PHOTO),d.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),n.notifyVersion(),n.retry&&_handleMessageQueue(n),n.heartBeat(),n.isAutoLogin&&n.setPresence(),console.log("conn",n);try{if(n.unSendMsgArr.length>0){console.log("unSendMesArr",n.unSendMsgArr);for(var p in n.unSendMsgArr){var f=n.unSendMsgArr[p];n.sendCommand(f),delete n.unSendMsgArr[p]}}}catch(e){console.error(e.message)}n.offLineSendConnecting=!1,n.logOut=!1,n.onOpened({canReceive:h,canSend:d,accessToken:n.context.accessToken})}else if(e==Strophe.Status.DISCONNECTING)n.isOpened()&&(n.stopHeartBeat(),n.context.status=_code.STATUS_CLOSING,o={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},r&&(o.conflict=!0),n.onError(o));else if(e==Strophe.Status.DISCONNECTED){if(!n.isClosing()||n.isOpened()){if(n.autoReconnectNumTotal<n.autoReconnectNumMax)return void n.reconnect(!n.isClosing());o={type:_code.WEBIM_CONNCTION_DISCONNECTED},n.onError(o)}n.context.status=_code.STATUS_CLOSED,n.clear(),n.onClosed()}else e==Strophe.Status.AUTHFAIL?(o={type:_code.WEBIM_CONNCTION_AUTH_ERROR},r&&(o.conflict=!0),n.onError(o),n.clear()):e==Strophe.Status.ERROR&&(n.context.status=_code.STATUS_ERROR,o={type:_code.WEBIM_CONNCTION_SERVER_ERROR},r&&(o.conflict=!0),n.onError(o));n.context.status_now=e},_getJid=function(e,t){var n=e.toJid||"";if(""===n){var r=t.context.appKey||"",o=r+"_"+e.to+"@"+t.domain;e.resource&&(o=o+"/"+e.resource),n=o}return n},_getJidByName=function(e,t){return _getJid({to:e},t)},_validCheck=function(e,t){if(e=e||{},""==e.user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var n=e.user+""||"",r=e.appKey||"",o=r.split("#");if(2!==o.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var i=o[0],s=o[1];if(!i)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=r+"_"+n.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=n+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=n,t.context.appKey=r,t.context.appName=s,t.context.orgName=i,!0},_getXmppUrl=function(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;var n={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(n.prefix="wss",n.suffix="/ws/"):t?n.prefix="https":window.WebSocket&&(n.prefix="ws",n.suffix="/ws/"),n.prefix+n.base+n.suffix},connection=function(e){if(!this instanceof connection)return new connection(e);var e=e||{};this.isHttpDNS=e.isHttpDNS||!1,this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https&&"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=!1!==e.isAutoLogin,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.sendQueue=new Queue,this.intervalId=null,this.apiUrl=e.apiUrl||"",this.isWindowSDK=e.isWindowSDK||!1,this.encrypt=e.encrypt||{encrypt:{type:"none"}},this.delivery=e.delivery||!1,this.user="",this.orgName="",this.appName="",this.token="",this.unSendMsgArr=[],this.dnsArr=["https://rs.easemob.com","https://rsbak.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=null,this.restIndex=0,this.restTotal=0,this.xmppHosts=null,this.xmppIndex=0,this.xmppTotal=0,this.groupOption={},isStropheLog=e.isStropheLog||!1};connection.prototype.registerUser=function(e){"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(e,"signup")):this.signup(e)},connection.prototype.handelSendQueue=function(){var e=this.sendQueue.pop();null!==e&&this.sendReceiptsMessage(e)},connection.prototype.listen=function(e){this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onDeliverdMessage=e.onDeliveredMessage||_utils.emptyfn,this.onReadMessage=e.onReadMessage||_utils.emptyfn,this.onMutedMessage=e.onMutedMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,this.onConfirmPop=e.onConfirmPop||_utils.emptyfn,this.onCreateGroup=e.onCreateGroup||_utils.emptyfn,this.onUpdateMyGroupList=e.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=e.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=e.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(e){!0!==e&&(e=!1);var t=this,n=!/^ws|wss/.test(t.url)||/mobile/.test(navigator.userAgent);if(!this.heartBeatID&&(e||n)){var r={toJid:this.domain,type:"normal"};this.heartBeatID=setInterval(function(){_utils.isSupportWss&&t.ping(r)},this.heartBeatWait)}},connection.prototype.stopHeartBeat=function(){"number"==typeof this.heartBeatID&&(this.heartBeatID=clearInterval(this.heartBeatID))},connection.prototype.sendReceiptsMessage=function(e){var t=$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.cacheReceiptsMessage=function(e){this.sendQueue.push(e)},connection.prototype.getStrophe=function(){if("https:"!=location.protocol&&this.isHttpDNS){var e="",t=this.xmppHosts[this.xmppIndex],n=_utils.getXmlFirstChild(t,"domain"),r=_utils.getXmlFirstChild(t,"ip");if(r){e=r.textContent;var o=_utils.getXmlFirstChild(t,"port");"80"!=o.textContent&&(e+=":"+o.textContent)}else e=n.textContent;if(""!=e){var i=/(.+\/\/).+(\/.+)/;this.url=this.url.replace(i,"$1"+e+"$2")}}return new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime})},connection.prototype.getHostsByTag=function(e,t){var n=_utils.getXmlFirstChild(e,t);if(!n)return console.log(t+" hosts error"),null;var r=n.getElementsByTagName("hosts");return 0==r.length?(console.log(t+" hosts error2"),null):r[0].getElementsByTagName("host")},connection.prototype.getRestFromHttpDNS=function(e,t){if(this.restIndex>this.restTotal)return void console.log("rest hosts all tried,quit");var n="",r=this.restHosts[this.restIndex],o=_utils.getXmlFirstChild(r,"domain"),i=_utils.getXmlFirstChild(r,"ip");if(i){var s=_utils.getXmlFirstChild(r,"port");n=("https:"===location.protocol?"https:":"http:")+"//"+i.textContent+":"+s.textContent}else n=("https:"===location.protocol?"https:":"http:")+"//"+o.textContent;""!=n&&(this.apiUrl=n,e.apiUrl=n),"login"==t?this.login(e):this.signup(e)},connection.prototype.getHttpDNS=function(e,t){var n=this,r=function(r,o){r=(new DOMParser).parseFromString(r,"text/xml").documentElement;var i=n.getHostsByTag(r,"rest");if(!i)return void console.log("rest hosts error3");n.restHosts=i,n.restTotal=i.length;var s=function(e){return Array.prototype.slice.call(e,0)};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(e){s=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t}}var a=s(n.getHostsByTag(r,"xmpp"));if(!a)return void console.log("xmpp hosts error3");for(var c=0;c<a.length;c++){var u=n.https?"https":"http";if(_utils.getXmlFirstChild(a[c],"protocol").textContent===u){var l=a[c];a.splice(c,1),a.unshift(l)}}n.xmppHosts=a,n.xmppTotal=a.length,n.getRestFromHttpDNS(e,t)},o=function(r,o,i){console.log("getHttpDNS error",r,i),++n.dnsIndex<n.dnsTotal&&n.getHttpDNS(e,t)},i={url:this.dnsArr[this.dnsIndex]+"/easemob/server.xml",dataType:"text",type:"GET",data:{app_key:encodeURIComponent(e.appKey)},success:r||_utils.emptyfn,error:o||_utils.emptyfn};_utils.ajax(i)},connection.prototype.signup=function(e){var t=this,n=e.orgName||"",r=e.appName||"",o=e.appKey||"",i=e.success||EMPTYFN,s=e.error||EMPTYFN;if(!n&&!r&&o){var a=o.split("#");2===a.length&&(n=a[0],r=a[1])}if(!n&&!r)return void s({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var c=function(n,r,o){if("https:"!=location.protocol&&t.isHttpDNS&&t.restIndex+1<t.restTotal)return t.restIndex++,void t.getRestFromHttpDNS(e,"signup");t.clear(),s(n)},u=e.https||u,l=e.apiUrl,h=l+"/"+n+"/"+r+"/users",d={username:e.username,password:e.password,nickname:e.nickname||""},p=_utils.stringify(d),f={url:h,dataType:"json",data:p,success:i,error:c};_utils.ajax(f)},connection.prototype.open=function(e){console.log(8888888);var t=e.appKey,n=t.split("#")[0],r=t.split("#")[1];this.orgName=n,this.appName=r,e.accessToken&&(this.token=e.accessToken),e.xmppURL&&(this.url=_getXmppUrl(e.xmppURL,this.https)),"https:"!=location.protocol&&this.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(e,"login")):this.login(e)},connection.prototype.login=function(e){if(this.user=e.user,_validCheck(e,this)){var t=this;if(!t.isOpened())if(e.accessToken)e.access_token=e.accessToken,t.context.restTokenData=e,_login(e,t);else{var n=e.apiUrl,r=this.context.userId,o=e.pwd||"",i=this.context.appName,s=this.context.orgName,a=function(n,r){t.context.status=_code.STATUS_DOLOGIN_IM,t.context.restTokenData=n,e.success&&e.success(n),t.token=n.access_token,_login(n,t)},c=function(n,r,o){if(e.error&&e.error(),"https:"!=location.protocol&&t.isHttpDNS&&t.restIndex+1<t.restTotal)return t.restIndex++,void t.getRestFromHttpDNS(e,"login");t.clear(),n.error&&n.error_description?t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:n,xhr:r}):t.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:n,xhr:r})};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var u={grant_type:"password",username:r,password:o,timestamp:+new Date},l=_utils.stringify(u),h={url:n+"/"+s+"/"+i+"/token",dataType:"json",data:l,success:a||_utils.emptyfn,error:c||_utils.emptyfn};_utils.ajax(h)}}},connection.prototype.attach=function(e){if(_validCheck(e,this)){e=e||{};var t=e.accessToken||"";if(""==t)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var n=e.sid||"";if(""===n)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var r=e.rid||"";if(""===r)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});var o=this.getStrophe();this.context.accessToken=t,this.context.stropheConn=o,this.context.status=_code.STATUS_DOLOGIN_IM;var i=this,s=function(e,t){_loginCallback(e,t,i)},a=this.context.jid,c=this.wait,u=this.hold,l=this.wind||5;o.attach(a,n,r,s,c,u,l)}},connection.prototype.close=function(e){this.logOut=!0,this.stopHeartBeat(),this.context.status!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(e)))},connection.prototype.addHandler=function(e,t,n,r,o,i,s){this.context.stropheConn.addHandler(e,t,n,r,o,i,s)},connection.prototype.notifyVersion=function(e,t){var n=(_getJid({},this),$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim")),e=e||_utils.emptyfn,r=t||this.onError,o=function(e){r({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),e,o)},connection.prototype.handlePresence=function(e){if(!this.isClosed()){var t=e.getAttribute("from")||"",n=e.getAttribute("to")||"",r=e.getAttribute("type")||"",o=e.getAttribute("presence_type")||"",i=_parseNameFromJidFn(t),s=_parseNameFromJidFn(n),a=!1,c=!1,u=!1,l=!1,h={from:i,to:s,fromJid:t,toJid:n,type:r,chatroom:!!e.getElementsByTagName("roomtype").length},d=e.getElementsByTagName("show");if(d&&d.length>0){var p=d[0];h.show=Strophe.getText(p)}var f=e.getElementsByTagName("status");if(f&&f.length>0){var m=f[0];h.status=Strophe.getText(m),h.code=m.getAttribute("code")}var _=e.getElementsByTagName("priority");if(_&&_.length>0){var g=_[0];h.priority=Strophe.getText(g)}var y=e.getElementsByTagName("error");if(y&&y.length>0){var y=y[0];h.error={code:y.getAttribute("code")}}var v=e.getElementsByTagName("destroy");if(v&&v.length>0){var v=v[0];h.destroy=!0;var N=v.getElementsByTagName("reason");N&&N.length>0&&(h.reason=Strophe.getText(N[0]))}var b=e.getElementsByTagName("item");if(b&&b.length>0){var E=b[0],S=E.getAttribute("role"),T=E.getAttribute("jid"),x=E.getAttribute("affiliation");if("none"==S&&T){var C=_parseNameFromJidFn(T),I=E.getElementsByTagName("actor")[0],O=I.getAttribute("nick");h.actor=O,h.kicked=C}"moderator"==S&&"201"==h.code&&"owner"===x&&(h.type="createGroupACK",a=!0)}var w=e.getElementsByTagName("x");if(w&&w.length>0){var R=w[0].getElementsByTagName("apply"),A=w[0].getElementsByTagName("accept"),M=w[0].getElementsByTagName("item"),B=w[0].getElementsByTagName("decline"),D=w[0].getElementsByTagName("add_admin"),k=w[0].getElementsByTagName("remove_admin"),j=w[0].getElementsByTagName("add_mute"),L=w[0].getElementsByTagName("remove_mute");if(R&&R.length>0){l=!0,h.toNick=R[0].getAttribute("toNick"),h.type="joinGroupNotifications";var F=R[0].getAttribute("to"),H=F.split("@")[0].split("_");H=H[H.length-1],h.gid=H}else if(A&&A.length>0)h.type="joinPublicGroupSuccess";else if(M&&M.length>0){var x=M[0].getAttribute("affiliation"),S=M[0].getAttribute("role");if("member"==x||"participant"==S){c=!0,h.mid=h.fromJid.split("/"),h.mid=h.mid[h.mid.length-1],h.type="memberJoinPublicGroupSuccess";var U=e.getElementsByTagName("roomtype");if(U&&U.length>0){var r=U[0].getAttribute("type");"chatroom"==r&&(h.type="memberJoinChatRoomSuccess")}}}else if(B&&B.length){u=!0;var H=B[0].getAttribute("fromNick"),W=_parseNameFromJidFn(B[0].getAttribute("from"));h.type="joinPublicGroupDeclined",h.owner=W,h.gid=H}else if(D&&D.length>0){var H=_parseNameFromJidFn(D[0].getAttribute("mucjid")),W=_parseNameFromJidFn(D[0].getAttribute("from"));h.owner=W,h.gid=H,h.type="addAdmin"}else if(k&&k.length>0){var H=_parseNameFromJidFn(k[0].getAttribute("mucjid")),W=_parseNameFromJidFn(k[0].getAttribute("from"));h.owner=W,h.gid=H,h.type="removeAdmin"}else if(j&&j.length>0){var H=_parseNameFromJidFn(j[0].getAttribute("mucjid")),W=_parseNameFromJidFn(j[0].getAttribute("from"));h.owner=W,h.gid=H,h.type="addMute"}else if(L&&L.length>0){var H=_parseNameFromJidFn(L[0].getAttribute("mucjid")),W=_parseNameFromJidFn(L[0].getAttribute("from"));h.owner=W,h.gid=H,h.type="removeMute"}}if(h.chatroom){h.presence_type=o,h.original_type=h.type;t.slice(t.lastIndexOf("/")+1)===this.context.userId&&(""!==h.type||h.code?"unavailable"!==o&&"unavailable"!==h.type||(h.status?110==h.code?h.type="leaveChatRoom":h.error&&406==h.error.code&&(h.type="reachChatRoomCapacity"):h.type="leaveChatRoom"):h.type="joinChatRoomSuccess")}else if(h.presence_type=o,h.original_type=r,/subscribe/.test(h.type));else if(""!=r||h.status||h.error||a||l||c||u){if("unavailable"===o||"unavailable"===r)if(h.destroy)h.type="deleteGroupChat";else if(307==h.code||321==h.code){var q=e.getAttribute("nick");h.type=q?"removedFromGroup":"leaveGroup"}}else console.log(2222222,e,h,l);this.onPresence(h,e)}},connection.prototype.handlePing=function(e){if(!this.isClosed()){var t=e.getAttribute("id"),n=e.getAttribute("from"),r=e.getAttribute("to"),o=$iq({from:r,to:n,id:t,type:"result"});this.sendCommand(o.tree())}},connection.prototype.handleIq=function(e){return!0},connection.prototype.handleIqPrivacy=function(e){0!=e.getElementsByTagName("list").length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(e){var t=e.getAttribute("id"),n=e.getAttribute("from")||"",r=(_parseNameFromJidFn(n),this.context.jid),o=(this.context.userId,$iq({type:"result",id:t,from:r}));this.sendCommand(o.tree());var i=e.getElementsByTagName("query");if(i&&i.length>0){var s=i[0],a=_parseFriend(s,this,n);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(e){var t=this;if(!this.isClosed()){var n=e.getAttribute("id")||"";this.cacheReceiptsMessage({id:n});var r=_parseResponseMessage(e);if(r.errorMsg)return void this.handlePresence(e);var o=e.getElementsByTagName("error"),i="",s="",a=!1;if(o.length>0){a=!0,i=o[0].getAttribute("code");var c=o[0].getElementsByTagName("text");s=c[0].textContent||c[0].text}var u=r.data;for(var l in u)if(u.hasOwnProperty(l)){var h=u[l];if(h.from&&h.to){var d=(h.from+"").toLowerCase(),p=(h.to+"").toLowerCase(),f=h.ext||{},m="",_=e.getElementsByTagName("roomtype");m=_.length?_[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";var g=h.bodies;if(g&&0!=g.length){var y=h.bodies[0],v=y.type,N=!1;try{switch(v){case"txt":var b=y.msg;if("base64"===t.encrypt.type)b=atob(b);else if("aes"===t.encrypt.type){var E=CryptoJS.enc.Utf8.parse(t.encrypt.key),S=CryptoJS.enc.Utf8.parse(t.encrypt.iv),T=t.encrypt.mode.toLowerCase(),x={};"cbc"===T?x={iv:S,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===T&&(x={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var C=b,I=CryptoJS.AES.decrypt(C,E,x),O=I.toString(CryptoJS.enc.Utf8);b=O}var w=_utils.parseTextMessage(b,WebIM.Emoji);if(w.isemoji){var h={id:n,type:m,from:d,to:p,delay:r.delayTimeStamp,data:w.body,ext:f};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onEmojiMessage(h)}else{var h={id:n,type:m,from:d,to:p,delay:r.delayTimeStamp,data:b,ext:f};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onTextMessage(h)}break;case"img":var R=0,A=0;y.size&&(R=y.size.width,A=y.size.height);var h={id:n,type:m,from:d,to:p,url:"https:"!=location.protocol&&t.isHttpDNS?t.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,thumb:y.thumb,thumb_secret:y.thumb_secret,file_length:y.file_length||"",width:R,height:A,filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onPictureMessage(h);break;case"audio":var h={id:n,type:m,from:d,to:p,url:"https:"!=location.protocol&&t.isHttpDNS?t.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,length:y.length||"",file_length:y.file_length||"",filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onAudioMessage(h);break;case"file":var h={id:n,type:m,from:d,to:p,url:"https:"!=location.protocol&&t.isHttpDNS?t.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onFileMessage(h);break;case"loc":var h={id:n,type:m,from:d,to:p,addr:y.addr,lat:y.lat,lng:y.lng,ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onLocationMessage(h);break;case"video":var h={id:n,type:m,from:d,to:p,url:"https:"!=location.protocol&&t.isHttpDNS?t.apiUrl+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:f,delay:r.delayTimeStamp};!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,this.onVideoMessage(h);break;case"cmd":var h={id:n,from:d,to:p,action:y.action,ext:f,delay:r.delayTimeStamp};if(!h.delay&&delete h.delay,h.error=a,h.errorText=s,h.errorCode=i,"em_retrieve_dns"===y.action&&(N=!0),0!==y.action.indexOf("em_"))t.onCmdMessage(h);else{var M=new WebIM.message("read",t.getUniqueId());M.set({id:h.id,to:h.from,ext:{logo:"easemob"}}),t.send(M.body),t.handelSendQueue()}}if(t.delivery){var B=t.getUniqueId(),D=h.id,k=new WebIM.message("delivery",B);k.set({id:D,to:h.from}),t.send(k.body)}N&&this.close()}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}}}}},connection.prototype.handleDeliveredMessage=function(e){var t=e.id,n=e.getElementsByTagName("body"),r=0;r=n[0].innerHTML;var o={mid:r};this.onDeliverdMessage(o),this.sendReceiptsMessage({id:t})},connection.prototype.handleAckedMessage=function(e){var t=e.id,n=e.getElementsByTagName("body"),r=0;r=n[0].innerHTML;var o={mid:r};this.onReadMessage(o),this.sendReceiptsMessage({id:t})},connection.prototype.handleReceivedMessage=function(e){try{var t=e.getElementsByTagName("received"),n=t[0].getAttribute("mid"),r=e.getElementsByTagName("body"),o=r[0].innerHTML,i={mid:n,id:o};this.onReceivedMessage(i)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}var o,n,s=e.getElementsByTagName("received");if(s.length>0&&(o=s[0].childNodes&&s[0].childNodes.length>0?s[0].childNodes[0].nodeValue:s[0].innerHTML||s[0].innerText,n=s[0].getAttribute("mid")),_msgHash[o]){try{_msgHash[o].msg.success instanceof Function&&_msgHash[o].msg.success(o,n)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[o]}},connection.prototype.handleInviteMessage=function(e){var t=null,n=e.getElementsByTagName("invite"),r=e.getElementsByTagName("reason")[0],o=r.textContent,i=e.getAttribute("id")||"";if(this.sendReceiptsMessage({id:i}),n&&n.length>0){var s=n[0].getAttribute("from");t=_parseNameFromJidFn(s)}var a=e.getElementsByTagName("x"),c=null;if(a&&a.length>0)for(var u=0;u<a.length;u++)if("jabber:x:conference"===a[u].namespaceURI){var l=a[u].getAttribute("jid");c=_parseNameFromJidFn(l)}this.onInviteMessage({type:"invite",from:t,roomid:c,reason:o})},connection.prototype.handleMutedMessage=function(e){var t=e.id;this.onMutedMessage({mid:t})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):(this.unSendMsgArr.push(e),this.offLineSendConnecting||this.logOut||(this.offLineSendConnecting=!0,this.reconnect()),this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0}))},connection.prototype.getUniqueId=function(e){this.autoIncrement?this.autoIncrement++:this.autoIncrement=1;var t=new Date,n=new Date(2010,1,1),r=t.getTime()-n.getTime(),o=parseFloat(r).toString(16)+this.autoIncrement;return"string"==typeof e||"number"==typeof e?e+"_"+o:"WEBIM_"+o},connection.prototype.send=function(e){var t=this,n=e;if("txt"===n.type)if("base64"===this.encrypt.type)n=_.clone(e),n.msg=btoa(n.msg);else if("aes"===this.encrypt.type){n=_.clone(e)
;var r=CryptoJS.enc.Utf8.parse(this.encrypt.key),o=CryptoJS.enc.Utf8.parse(this.encrypt.iv),i=this.encrypt.mode.toLowerCase(),s={};"cbc"===i?s={iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}:"ebc"===i&&(s={mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7});var a=CryptoJS.AES.encrypt(n.msg,r,s);n.msg=a.toString()}if(this.isWindowSDK)WebIM.doQuery('{"type":"sendMessage","to":"'+n.to+'","message_type":"'+n.type+'","msg":"'+encodeURI(n.msg)+'","chatType":"'+n.chatType+'"}',function(e){},function(e,n){var r={data:{data:"send"},type:_code.WEBIM_MESSAGE_SED_ERROR};t.onError(r)});else if("[object Object]"===Object.prototype.toString.call(n)){var c=this.context.appKey||"",u=c+"_"+n.to+"@"+this.domain;n.group&&(u=c+"_"+n.to+"@conference."+this.domain),n.resource&&(u=u+"/"+n.resource),n.toJid=u,n.id=n.id||this.getUniqueId(),_msgHash[n.id]=new _message(n),_msgHash[n.id].send(this)}else"string"==typeof n&&_msgHash[n]&&_msgHash[n].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),n=e.name||"",r=e.groups||"",o=$iq({type:"set"});if(o.c("query",{xmlns:"jabber:iq:roster"}),o.c("item",{jid:t,name:n}),r)for(var i=0;i<r.length;i++)o.c("group").t(r[i]).up();var s=e.success||_utils.emptyfn,a=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o.tree(),s,a)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),n=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),r=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(n,r,o)},connection.prototype.getRoster=function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),e=e||{},n=e.success||this.onRoster,r=function(e){var t=[],r=e.getElementsByTagName("query");if(r&&r.length>0){var o=r[0];t=_parseFriend(o)}n(t,e)},o=e.error||this.onError,i=function(e){o({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),r,i):o({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"subscribe"});e.message&&n.c("status").t(e.message).up(),e.nick&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(n.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"subscribed"});e.message&&n.c("status").t(e.message).up(),this.sendCommand(n.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"unsubscribe"});e.message&&n.c("status").t(e.message),this.sendCommand(n.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),n=$pres({to:t,type:"unsubscribed"});e.message&&n.c("status").t(e.message).up(),this.sendCommand(n.tree())},connection.prototype.joinPublicGroup=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,r=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,i=function(e){o({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(s.tree(),r,i)},connection.prototype.listRooms=function(e){var t=$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),n=e.success||_utils.emptyfn,r=e.error||this.onError,o=function(e){var t=[];t=_parseRoom(e);try{n(t)}catch(e){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}},i=e.error||_utils.emptyfn,s=function(e){i({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})};this.context.stropheConn.sendIQ(t.tree(),o,s)},connection.prototype.queryRoomMember=function(e){var t=(this.domain,[]),n=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),r=e.success||_utils.emptyfn,o=function(e){var n=e.getElementsByTagName("item");if(n)for(var o=0;o<n.length;o++){var i=n[o],s={jid:i.getAttribute("jid"),affiliation:"member"};t.push(s)}r(t)},i=e.error||_utils.emptyfn,s=function(e){i({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),o,s)},connection.prototype.queryRoomInfo=function(e){var t=this.domain,n=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),r=e.success||_utils.emptyfn,o=[],i=function(e){var n="",i=e.getElementsByTagName("feature");switch(i&&(n=i[1].getAttribute("var")+"|"+i[3].getAttribute("var")+"|"+i[4].getAttribute("var")),n){case"muc_public|muc_membersonly|muc_notallowinvites":n="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":n="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":n="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":n="PRIVATE_OWNER_INVITE"}var s=e.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var u=s[c],l=u.getAttribute("var"),h=l.split("_")[1];switch(l){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[h]=u.textContent||u.text||"";break;case"muc#roominfo_owner":var d={jid:(u.textContent||u.text)+"@"+t,affiliation:"owner"};o.push(d),a[h]=u.textContent||u.text}}a.name=e.getElementsByTagName("identity")[0].getAttribute("name")}r(n,o,a)},s=e.error||_utils.emptyfn,a=function(e){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})};this.context.stropheConn.sendIQ(n.tree(),i,a)},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,n=function(e){var n=[];n=_parseRoomOccupants(e),t(n)},r=e.error||_utils.emptyfn,o=function(e){r({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})},i={xmlns:Strophe.NS.DISCO_ITEMS},s=$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",i);this.context.stropheConn.sendIQ(s.tree(),n,o)},connection.prototype.setUserSig=function(e){var t=$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var n=$pres({xmlns:"jabber:client"});e&&(t?(n.c("show").t(e),n.up().c("status").t(t)):n.c("show").t(e)),this.sendCommand(n.tree())},connection.prototype.getPresence=function(){var e=$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){var e=e||{},t=_getJid(e,this),n=$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),r=e.success||_utils.emptyfn,o=e.error||this.onError,i=function(e){o({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(n.tree(),r,i):o({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;if(this.errorType!=_code.WEBIM_CONNCTION_DISCONNECTED&&this.logOut&&(this.unSendMsgArr=[],this.offLineSendConnecting=!1,this.context={status:_code.STATUS_INIT,appKey:e}),this.intervalId&&clearInterval(this.intervalId),this.restIndex=0,this.xmppIndex=0,this.errorType==_code.WEBIM_CONNCTION_CLIENT_LOGOUT||-1==this.errorType){var t={data:{data:"logout"},type:_code.WEBIM_CONNCTION_CLIENT_LOGOUT};this.onError(t)}},connection.prototype.getChatRooms=function(e){if(!_utils.isCanSetRequestHeader)return void t.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});var t=this,n=e.accessToken||this.context.accessToken;if(n){var r=e.apiUrl,o=this.context.appName,i=this.context.orgName;if(!o||!i)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s=function(t,n){"function"==typeof e.success&&e.success(t)},a=function(e,n,r){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:n})},c={pagenum:parseInt(e.pagenum)||1,pagesize:parseInt(e.pagesize)||20},u={url:r+"/"+i+"/"+o+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+n},data:c,success:s||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(u)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,r=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,i=function(e){o({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),r,i)},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,n=t+"/"+this.context.userId,r=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,i=function(e){o({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:n,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),r,i)},connection.prototype._onReceiveInviteFromGroup=function(info){info=eval("("+info+")");var self=this,options={title:"Group invitation",msg:info.user+" invites you to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){var n={data:{data:"acceptInvitationFromGroup error:"+t},type:_code.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){var n={data:{data:"declineInvitationFromGroup error:"+t},type:_code.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" agreed to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteDeclineFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" rejected to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onAutoAcceptInvitationFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:"You had joined into the group:"+info.group_name+" automatically.Inviter:"+info.user,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onLeaveGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been out of the group:"+info.group_id+".Reason:"+info.msg,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveJoinGroupApplication=function(info){info=eval("("+info+")");var self=this,options={title:"Group join application",msg:info.user+" applys to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){var n={data:{data:"acceptJoinGroupApplication error:"+t},type:_code.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP};self.onError(n)})},reject:function(){WebIM.doQuery('{"type":"declineJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){var n={data:{data:"declineJoinGroupApplication error:"+t},type:_code.WEBIM_CONNECTION_DECLINE_JOIN_GROUP};self.onError(n)})}};this.onConfirmPop(options)},connection.prototype._onReceiveAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You had joined into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveRejectionFromGroup=function(){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been rejected to join into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onUpdateMyGroupList=function(e){this.onUpdateMyGroupList(e)},connection.prototype._onUpdateMyRoster=function(e){this.onUpdateMyRoster(e)},connection.prototype.reconnect=function(e){var t=this;e&&t.xmppIndex++,setTimeout(function(){_login(t.context.restTokenData,t)},1e3*(0==this.autoReconnectNumTotal?0:this.autoReconnectInterval)),this.autoReconnectNumTotal++},connection.prototype.closed=function(){var e={data:{data:"Closed error"},type:_code.WEBIM_CONNECTION_CLOSED};this.onError(e)},connection.prototype.getBlacklist=function(e){e=e||{};var t=$iq({type:"get"}),n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,o=this;t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(t.tree(),function(e){o.onBlacklistUpdate(_parsePrivacy(e)),n()},function(){o.onBlacklistUpdate([]),r()})},connection.prototype.addToBlackList=function(e){for(var t=$iq({type:"set"}),n=e.list||{},r=e.type||"jid",o=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,s=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),a=Object.keys(n),c=a.length,u=2,l=0;l<c;l++){var h=n[a[l]],r=h.type||"jid",d=h.jid;s=s.c("item",{action:"deny",order:u++,type:r,value:d}).c("message"),l!==c-1&&(s=s.up().up())}this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype.removeFromBlackList=function(e){for(var t=$iq({type:"set"}),n=e.list||{},r=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,i=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(n),a=s.length,c=0;c<a;c++){var u=n[s[c]],l=u.type||"jid",h=u.jid,d=u.order;i=i.c("item",{action:"deny",order:d,type:l,value:h}).c("message"),c!==a-1&&(i=i.up().up())}this.context.stropheConn.sendIQ(i.tree(),r,o)},connection.prototype._getGroupJid=function(e){return(this.context.appKey||"")+"_"+e+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=_getJid(e,this),o=this._getGroupJid(e.roomId),i=$iq({type:"set",to:o});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast",jid:r}),this.context.stropheConn.sendIQ(i.tree(),t,n)},connection.prototype.getGroupBlacklist=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=this._getGroupJid(e.roomId),o=$iq({type:"get",to:r});o.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(o.tree(),function(e){t(_parseGroupBlacklist(e))},function(){n()})},connection.prototype.removeGroupMemberFromBlacklist=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=_getJid(e,this),o=this._getGroupJid(e.roomId),i=$iq({type:"set",to:o});i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:r}),this.context.stropheConn.sendIQ(i.tree(),function(e){t()},function(){n()})},connection.prototype.changeGroupSubject=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=this._getGroupJid(e.roomId),o=$iq({type:"set",to:r});o.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(e.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(e.description),this.context.stropheConn.sendIQ(o.tree(),function(e){t()},function(){n()})},connection.prototype.destroyGroup=function(e){var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=this._getGroupJid(e.roomId),o=$iq({type:"set",to:r});o.c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("destroy").c("reason").t(e.reason||""),this.context.stropheConn.sendIQ(o.tree(),function(e){t()},function(){n()})},connection.prototype.leaveGroupBySelf=function(e){var t=this,n=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,o=_getJid(e,this),i=this._getGroupJid(e.roomId),s=$iq({type:"set",to:i});s.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"none",jid:o}),this.context.stropheConn.sendIQ(s.tree(),function(e){n(e);var r=$pres({type:"unavailable",to:i+"/"+t.context.userId});t.sendCommand(r.tree())},function(e){r(e)})},connection.prototype.leaveGroup=function(e){for(var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=e.list||[],o=this._getGroupJid(e.roomId),i=$iq({type:"set",to:o}),s=i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=Object.keys(r),c=a.length,u=0;u<c;u++){var l=r[a[u]],h=_getJidByName(l,this);s=s.c("item",{affiliation:"none",jid:h}).up().c("item",{role:"none",jid:h}).up()}this.context.stropheConn.sendIQ(i.tree(),function(e){t(e)},function(e){n(e)})},connection.prototype.addGroupMembers=function(e){for(var t=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,r=e.list||[],o=this._getGroupJid(e.roomId),i=$iq({type:"set",to:o}),s=i.c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}),a=r.length,c=0;c<a;c++){var u=r[c],l=_getJidByName(u,this);s=s.c("item",{affiliation:"member",jid:l}).up();var h=$msg({to:o}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:l}).c("reason").t(e.reason||"");this.sendCommand(h.tree())}this.context.stropheConn.sendIQ(i.tree(),function(e){t(e)},function(e){n(e)})},connection.prototype.acceptInviteFromGroup=function(e){e.success=function(){},this.addGroupMembers(e)},connection.prototype.rejectInviteFromGroup=function(e){},connection.prototype.createGroupAsync=function(e){var t=e.from,n=this,r=this._getGroupJid(t),o=(this.context.userId,this.groupOption),i=e.success||_utils.emptyfn,s=$iq({type:"get",to:r}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});n.context.stropheConn.sendIQ(s.tree(),function(e){if("setAttribute"in e){var s=e.getElementsByTagName("x")[0];s.setAttribute("type","submit")}else Strophe.forEachChild(e,"x",function(e){e.setAttribute("type","submit")});Strophe.info("step 5 ----------"),Strophe.forEachChild(s,"field",function(e){var t=e.getAttribute("var"),n=e.getElementsByTagName("value")[0];switch(Strophe.info(t),t){case"muc#roomconfig_maxusers":_setText(n,o.optionsMaxUsers||200);break;case"muc#roomconfig_roomname":_setText(n,o.subject||"");break;case"muc#roomconfig_roomdesc":_setText(n,o.description||"");break;case"muc#roomconfig_publicroom":_setText(n,+o.optionsPublic);break;case"muc#roomconfig_membersonly":_setText(n,+o.optionsMembersOnly);break;case"muc#roomconfig_moderatedroom":_setText(n,+o.optionsModerate);break;case"muc#roomconfig_persistentroom":_setText(n,1);break;case"muc#roomconfig_allowinvites":_setText(n,+o.optionsAllowInvites);break;case"muc#roomconfig_allowvisitornickchange":case"muc#roomconfig_allowvisitorstatus":case"allow_private_messages":_setText(n,0);break;case"allow_private_messages_from_visitors":_setText(n,"nobody")}});var a=$iq({to:r,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).cnode(s);n.context.stropheConn.sendIQ(a.tree(),function(e){n.addGroupMembers({list:o.members,roomId:t}),i(o)},function(e){})},function(e){})},connection.prototype.createGroup=function(e){this.groupOption=e;var t=+new Date,n=this._getGroupJid(t),r=n+"/"+this.context.userId,o=$pres({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).up().c("create",{xmlns:"http://jabber.org/protocol/muc"}).up();this.sendCommand(o.tree())},connection.prototype.createGroupNew=function(e){e.data.owner=this.user,e.data.invite_need_confirm=!1;var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups",dataType:"json",type:"POST",data:JSON.stringify(e.data),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};t.success=function(t){e.success(t),this.onCreateGroup(t)}.bind(this),t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.blockGroup=function(e){var t=e.groupId;t="notification_ignore_"+t;var n={entities:[]};n.entities[0]={},n.entities[0][t]=!0;var r={type:"PUT",url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user,data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.joinGroup=function(e){var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e.groupId+"/apply",type:"POST",dataType:"json",data:JSON.stringify({message:"join group"}),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};t.success=e.success||_utils.emptyfn,t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.listGroups=function(e){var t=[];if(t.limit=e.limit,t.cursor=e.cursor,t.cursor||delete t.cursor,isNaN(e.limit))throw'The parameter "limit" should be a number';var n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/publicchatgroups",type:"GET",dataType:"json",data:t,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupInfo=function(e){var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+e.groupId,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};t.success=e.success||_utils.emptyfn,t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.getGroup=function(e){var t={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users/"+this.user+"/joined_chatgroups",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};t.success=e.success||_utils.emptyfn,t.error=e.error||_utils.emptyfn,WebIM.utils.ajax(t)},connection.prototype.listGroupMember=function(e){if(isNaN(e.pageNum)||e.pageNum<=0)throw'The parameter "pageNum" should be a positive number';if(isNaN(e.pageSize)||e.pageSize<=0)throw'The parameter "pageSize" should be a positive number';if(null===e.groupId&&void 0===e.groupId)throw'The parameter "groupId" should be added';var t=[],n=e.groupId;t.pagenum=e.pageNum,t.pagesize=e.pageSize;var r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+n+"/users",dataType:"json",type:"GET",data:t,headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.mute=function(e){var t=e.groupId,n={usernames:[e.username],mute_duration:e.muteDuration},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/mute",dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify(n)};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeMute=function(e){var t=e.groupId,n=e.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/mute/"+n,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.getGroupAdmin=function(e){var t=e.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getMuted=function(e){var t=e.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.setAdmin=function(e){var t=e.groupId,n={newadmin:e.username},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/admin",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeAdmin=function(e){var t=e.groupId,n=e.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/admin/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.agreeJoinGroup=function(e){var t=e.groupId,n={applicant:e.applicant,verifyResult:!0,reason:"no clue"},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.rejectJoinGroup=function(e){var t=e.groupId,n={applicant:e.applicant,verifyResult:!1,reason:"no clue"},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/apply_verify",type:"POST",dataType:"json",data:JSON.stringify(n),headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.groupBlockSingle=function(e){var t=e.groupId,n=e.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/blocks/users/"+n,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.groupBlockMulti=function(e){var t=e.groupId,n=e.usernames,r={usernames:n},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/blocks/users",data:JSON.stringify(r),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=e.success||_utils.emptyfn,o.error=e.error||_utils.emptyfn,WebIM.utils.ajax(o)},connection.prototype.removeGroupBlockSingle=function(e){var t=e.groupId,n=e.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeGroupBlockMulti=function(e){var t=e.groupId,n=e.username.join(","),r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/blocks/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.dissolveGroup=function(e){var t=e.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"?version=v3",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.getGroupBlacklistNew=function(e){var t=e.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.quitGroup=function(e){var t=e.groupId,n={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/quit",type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};n.success=e.success||_utils.emptyfn,n.error=e.error||_utils.emptyfn,WebIM.utils.ajax(n)},connection.prototype.modifyGroup=function(e){var t=e.groupId,n={groupname:e.groupName,description:e.description},r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t,type:"PUT",data:JSON.stringify(n),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeSingleGroupMember=function(e){var t=e.groupId,n=e.username,r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.removeMultiGroupMember=function(e){var t=e.groupId,n=e.users.join(","),r={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/users/"+n,type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};r.success=e.success||_utils.emptyfn,r.error=e.error||_utils.emptyfn,WebIM.utils.ajax(r)},connection.prototype.inviteToGroup=function(e){var t=e.groupId,n=e.users,r={usernames:n},o={url:this.apiUrl+"/"+this.orgName+"/"+this.appName+"/chatgroups/"+t+"/invite",type:"POST",data:JSON.stringify(r),dataType:"json",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}};o.success=e.success||_utils.emptyfn,o.error=e.error||_utils.emptyfn,WebIM.utils.ajax(o)};var WebIM=window.WebIM||{};WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(e,t,n){void 0!==window.cefQuery&&window.cefQuery({request:e,persistent:!1,onSuccess:t,onFailure:n})},WebIM.debug=function(e){logMessage=function(t){e&&console.log(WebIM.utils.ts()+"[recv] ",t.data)},Strophe.Connection.prototype.rawOutput=function(t){e&&console.log("%c "+WebIM.utils.ts()+"[send] "+t,"background-color: #e2f7da")}},module.exports=WebIM},function(e,t,n){(function(t){!function(t,n){e.exports=n()}(0,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function r(e){return o(e)||i(e)||s()}function o(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(){for(var e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}function c(){if("undefined"==typeof document)try{return(new(0,n(4).DOMImplementation)).createDocument("jabber:client","strophe",null)}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}if(void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10){var e=a();return e.appendChild(e.createElement("strophe")),e}
return document.implementation.createDocument("jabber:client","strophe",null)}function u(e){if(e="".concat(e),e=e.replace(/[ \t\n\f\r]/g,""),e.length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+\/0-9A-Za-z]/.test(e))return null;for(var t="",n=0,r=0,o=0;o<e.length;o++)n<<=6,n|=l(e[o]),24===(r+=6)&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t}function l(e){return/[A-Z]/.test(e)?e.charCodeAt(0)-"A".charCodeAt(0):/[a-z]/.test(e)?e.charCodeAt(0)-"a".charCodeAt(0)+26:/[0-9]/.test(e)?e.charCodeAt(0)-"0".charCodeAt(0)+52:"+"===e?62:"/"===e?63:void 0}function h(e){var t;for(e="".concat(e),t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;var n="";for(t=0;t<e.length;t+=3){var r=[void 0,void 0,void 0,void 0];r[0]=e.charCodeAt(t)>>2,r[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(r[1]|=e.charCodeAt(t+1)>>4,r[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(r[2]|=e.charCodeAt(t+2)>>6,r[3]=63&e.charCodeAt(t+2));for(var o=0;o<r.length;o++)void 0===r[o]?n+="=":n+=d(r[o])}return n}function d(e){return e<26?String.fromCharCode(e+"A".charCodeAt(0)):e<52?String.fromCharCode(e-26+"a".charCodeAt(0)):e<62?String.fromCharCode(e-52+"0".charCodeAt(0)):62===e?"+":63===e?"/":void 0}function p(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var n,r,o,i,s,a,c,u,l=new Array(80),h=1732584193,d=-271733879,p=-1732584194,_=271733878,v=-1009589776;for(n=0;n<e.length;n+=16){for(i=h,s=d,a=p,c=_,u=v,r=0;r<80;r++)l[r]=r<16?e[n+r]:y(l[r-3]^l[r-8]^l[r-14]^l[r-16],1),o=g(g(y(h,5),f(r,d,p,_)),g(g(v,l[r]),m(r))),v=_,_=p,p=y(d,30),d=h,h=o;h=g(h,i),d=g(d,s),p=g(p,a),_=g(_,c),v=g(v,u)}return[h,d,p,_,v]}function f(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function m(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function _(e,t){var n=v(e);n.length>16&&(n=p(n,8*e.length));for(var r=new Array(16),o=new Array(16),i=0;i<16;i++)r[i]=909522486^n[i],o[i]=1549556828^n[i];var s=p(r.concat(v(t)),512+8*t.length);return p(o.concat(s),672)}function g(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function y(e,t){return e<<t|e>>>32-t}function v(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function N(e){for(var t,n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="",i=0;i<4*e.length;i+=3)for(t=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,n=0;n<4;n++)8*i+6*n>32*e.length?o+="=":o+=r.charAt(t>>6*(3-n)&63);return o}function b(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function E(e,t){return new $.Builder(e,t)}function S(e){return new $.Builder("message",e)}function T(e){return new $.Builder("iq",e)}function x(e){return new $.Builder("presence",e)}var C=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},I=function(){var e=C.WebSocket;if(void 0===e)try{e=n(3)}catch(e){throw new Error('You must install the "ws" package to use Strophe in nodejs.')}return e}(),O=function(){var e=C.DOMParser;if(void 0===e)try{e=n(4).DOMParser}catch(e){throw new Error('You must install the "xmldom" package to use Strophe in nodejs.')}return e}(),w=u,R=h,A={atob:w,btoa:R},M=A.atob,B=A.btoa,D=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},k=function(e,t){return e<<t|e>>>32-t},j=function(e){if("string"!=typeof e)throw new Error("str2binl was passed a non-string");for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},L=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},F=function(e){for(var t="0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n},H=function(e,t,n,r,o,i){return D(k(D(D(t,e),D(r,i)),o),n)},U=function(e,t,n,r,o,i,s){return H(t&n|~t&r,e,t,o,i,s)},W=function(e,t,n,r,o,i,s){return H(t&r|n&~r,e,t,o,i,s)},q=function(e,t,n,r,o,i,s){return H(t^n^r,e,t,o,i,s)},G=function(e,t,n,r,o,i,s){return H(n^(t|~r),e,t,o,i,s)},P=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,r,o,i,s=1732584193,a=-271733879,c=-1732584194,u=271733878,l=0;l<e.length;l+=16)n=s,r=a,o=c,i=u,s=U(s,a,c,u,e[l+0],7,-680876936),u=U(u,s,a,c,e[l+1],12,-389564586),c=U(c,u,s,a,e[l+2],17,606105819),a=U(a,c,u,s,e[l+3],22,-1044525330),s=U(s,a,c,u,e[l+4],7,-176418897),u=U(u,s,a,c,e[l+5],12,1200080426),c=U(c,u,s,a,e[l+6],17,-1473231341),a=U(a,c,u,s,e[l+7],22,-45705983),s=U(s,a,c,u,e[l+8],7,1770035416),u=U(u,s,a,c,e[l+9],12,-1958414417),c=U(c,u,s,a,e[l+10],17,-42063),a=U(a,c,u,s,e[l+11],22,-1990404162),s=U(s,a,c,u,e[l+12],7,1804603682),u=U(u,s,a,c,e[l+13],12,-40341101),c=U(c,u,s,a,e[l+14],17,-1502002290),a=U(a,c,u,s,e[l+15],22,1236535329),s=W(s,a,c,u,e[l+1],5,-165796510),u=W(u,s,a,c,e[l+6],9,-1069501632),c=W(c,u,s,a,e[l+11],14,643717713),a=W(a,c,u,s,e[l+0],20,-373897302),s=W(s,a,c,u,e[l+5],5,-701558691),u=W(u,s,a,c,e[l+10],9,38016083),c=W(c,u,s,a,e[l+15],14,-660478335),a=W(a,c,u,s,e[l+4],20,-405537848),s=W(s,a,c,u,e[l+9],5,568446438),u=W(u,s,a,c,e[l+14],9,-1019803690),c=W(c,u,s,a,e[l+3],14,-187363961),a=W(a,c,u,s,e[l+8],20,1163531501),s=W(s,a,c,u,e[l+13],5,-1444681467),u=W(u,s,a,c,e[l+2],9,-51403784),c=W(c,u,s,a,e[l+7],14,1735328473),a=W(a,c,u,s,e[l+12],20,-1926607734),s=q(s,a,c,u,e[l+5],4,-378558),u=q(u,s,a,c,e[l+8],11,-2022574463),c=q(c,u,s,a,e[l+11],16,1839030562),a=q(a,c,u,s,e[l+14],23,-35309556),s=q(s,a,c,u,e[l+1],4,-1530992060),u=q(u,s,a,c,e[l+4],11,1272893353),c=q(c,u,s,a,e[l+7],16,-155497632),a=q(a,c,u,s,e[l+10],23,-1094730640),s=q(s,a,c,u,e[l+13],4,681279174),u=q(u,s,a,c,e[l+0],11,-358537222),c=q(c,u,s,a,e[l+3],16,-722521979),a=q(a,c,u,s,e[l+6],23,76029189),s=q(s,a,c,u,e[l+9],4,-640364487),u=q(u,s,a,c,e[l+12],11,-421815835),c=q(c,u,s,a,e[l+15],16,530742520),a=q(a,c,u,s,e[l+2],23,-995338651),s=G(s,a,c,u,e[l+0],6,-198630844),u=G(u,s,a,c,e[l+7],10,1126891415),c=G(c,u,s,a,e[l+14],15,-1416354905),a=G(a,c,u,s,e[l+5],21,-57434055),s=G(s,a,c,u,e[l+12],6,1700485571),u=G(u,s,a,c,e[l+3],10,-1894986606),c=G(c,u,s,a,e[l+10],15,-1051523),a=G(a,c,u,s,e[l+1],21,-2054922799),s=G(s,a,c,u,e[l+8],6,1873313359),u=G(u,s,a,c,e[l+15],10,-30611744),c=G(c,u,s,a,e[l+6],15,-1560198380),a=G(a,c,u,s,e[l+13],21,1309151649),s=G(s,a,c,u,e[l+4],6,-145523070),u=G(u,s,a,c,e[l+11],10,-1120210379),c=G(c,u,s,a,e[l+2],15,718787259),a=G(a,c,u,s,e[l+9],21,-343485551),s=D(s,n),a=D(a,r),c=D(c,o),u=D(u,i);return[s,a,c,u]},J={hexdigest:function(e){return F(P(j(e),8*e.length))},hash:function(e){return L(P(j(e),8*e.length))}},z={b64_hmac_sha1:function(e,t){return N(_(e,t))},b64_sha1:function(e){return N(p(v(e),8*e.length))},binb2str:b,core_hmac_sha1:_,str_hmac_sha1:function(e,t){return b(_(e,t))},str_sha1:function(e){return b(p(v(e),8*e.length))}},X={utf16to8:function(e){var t,n,r="",o=e.length;for(t=0;t<o;t++)n=e.charCodeAt(t),n>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(t){t=t||{};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r="",o="",i="",s=t[n],a="object"===e(s),c=escape(unescape(a?s.value:s));a&&(r=s.expires?";expires="+s.expires:"",o=s.domain?";domain="+s.domain:"",i=s.path?";path="+s.path:""),document.cookie=n+"="+c+r+o+i}}},$={VERSION:"1.3.6",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<$.XHTML.tags.length;t++)if(e===$.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==$.XHTML.attributes[e]&&$.XHTML.attributes[e].length>0)for(var n=0;n<$.XHTML.attributes[e].length;n++)if(t===$.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<$.XHTML.css.length;t++)if(e===$.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){$.NS[e]=t},forEachChild:function(e,t,n){for(var r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];o.nodeType!==$.ElementType.NORMAL||t&&!this.isTagEqual(o,t)||n(o)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,xmlGenerator:function(){return $._xmlGenerator||($._xmlGenerator=c()),$._xmlGenerator},xmlElement:function(t){if(!t)return null;for(var n=$.xmlGenerator().createElement(t),r=1;r<arguments.length;r++){var o=arguments[r];if(o)if("string"==typeof o||"number"==typeof o)n.appendChild($.xmlTextNode(o));else if("object"===e(o)&&"function"==typeof o.sort)for(var i=0;i<o.length;i++){var s=o[i];"object"===e(s)&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&n.setAttribute(s[0],s[1])}else if("object"===e(o))for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&void 0!==o[a]&&null!==o[a]&&n.setAttribute(a,o[a])}return n},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,'"')},xmlTextNode:function(e){return $.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;if(O){t=(new O).parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===$.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===$.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return $.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===$.ElementType.NORMAL){t=$.xmlElement(e.tagName);for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(var r=0;r<e.childNodes.length;r++)t.appendChild($.copyElement(e.childNodes[r]))}else e.nodeType===$.ElementType.TEXT&&(t=$.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(t){var n;if(t.nodeType===$.ElementType.NORMAL){var r=t.nodeName.toLowerCase();if($.XHTML.validTag(r))try{n=$.xmlElement(r);for(var o=0;o<$.XHTML.attributes[r].length;o++){var i=$.XHTML.attributes[r][o],s=t.getAttribute(i);if(void 0!==s&&null!==s&&""!==s&&!1!==s&&0!==s)if("style"===i&&"object"===e(s)&&void 0!==s.cssText&&(s=s.cssText),"style"===i){for(var a=[],c=s.split(";"),u=0;u<c.length;u++){var l=c[u].split(":"),h=l[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if($.XHTML.validCSS(h)){var d=l[1].replace(/^\s*/,"").replace(/\s*$/,"");a.push(h+": "+d)}}a.length>0&&(s=a.join("; "),n.setAttribute(i,s))}else n.setAttribute(i,s)}for(var p=0;p<t.childNodes.length;p++)n.appendChild($.createHtml(t.childNodes[p]))}catch(e){n=$.xmlTextNode("")}else{n=$.xmlGenerator().createDocumentFragment();for(var f=0;f<t.childNodes.length;f++)n.appendChild($.createHtml(t.childNodes[f]))}}else if(t.nodeType===$.ElementType.FRAGMENT){n=$.xmlGenerator().createDocumentFragment();for(var m=0;m<t.childNodes.length;m++)n.appendChild($.createHtml(t.childNodes[m]))}else t.nodeType===$.ElementType.TEXT&&(n=$.xmlTextNode(t.nodeValue));return n},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=$.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){if(!e)return null;var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&$.fatal(e.stack),e.sourceURL?$.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?$.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):$.fatal("error: "+e.message)},log:function(t,n){t===this.LogLevel.FATAL&&"object"===e(window.console)&&"function"==typeof window.console.error&&window.console.error(n)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=r(Array(e.attributes.length).keys()).map(function(t){return e.attributes[t].nodeName});t.sort();var n=t.reduce(function(t,n){return"".concat(t," ").concat(n,'="').concat($.xmlescape(e.attributes.getNamedItem(n).value),'"')},"<".concat(e.nodeName));if(e.childNodes.length>0){n+=">";for(var o=0;o<e.childNodes.length;o++){var i=e.childNodes[o];switch(i.nodeType){case $.ElementType.NORMAL:n+=$.serialize(i);break;case $.ElementType.TEXT:n+=$.xmlescape(i.nodeValue);break;case $.ElementType.CDATA:n+="<![CDATA["+i.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){$._connectionPlugins[e]=t}};$.Builder=function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=$.NS.CLIENT:t||(t={xmlns:$.NS.CLIENT})),this.nodeTree=$.xmlElement(e,t),this.node=this.nodeTree},$.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return $.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var r=$.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(e){var t,n=$.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var r=t?n.importNode(e,!0):$.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=$.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=$.xmlGenerator().createElement("body");t.innerHTML=e;for(var n=$.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},$.Handler=function(e,t,n,r,o,i,s){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=o,this.options=s||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&($.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=i?$.getBareJidFromJid(i):null:this.from=i,this.user=!0},$.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,n=!1;return!this.ns||($.forEachChild(e,null,function(e){t.getNamespace(e)===t.ns&&(n=!0)}),n||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=$.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!$.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw $._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},$.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},$.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},$.Connection=function(e,t){var n=this;this.service=e,this.options=t||{};var r=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new $.Websocket(this):this._proto=new $.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return n._onIdle()},100),X.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(var o in $._connectionPlugins)if(Object.prototype.hasOwnProperty.call($._connectionPlugins,o)){var i=function(){};i.prototype=$._connectionPlugins[o],this[o]=new i,this[o].init(this)}},$.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,r,o,i,s){this.jid=e,this.authzid=$.getBareJidFromJid(this.jid),this.authcid=s||$.getNodeFromJid(this.jid),this.pass=t,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=$.getDomainFromJid(this.jid),this._changeConnectStatus($.Status.CONNECTING,null),this._proto._connect(r,o,i)},attach:function(e,t,n,r,o,i,s){if(!(this._proto instanceof $.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,n,r,o,i,s)},restore:function(e,t,n,r,o){if(!this._sessionCachingSupported()){var i=new Error('The "restore" method can only be used with a BOSH connection.');throw i.name="StropheSessionError",i}this._proto._restore(e,t,n,r,o)},_sessionCachingSupported:function(){if(this._proto instanceof $.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,r){var o=this,i=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){i&&o.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,s);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s},sendIQ:function(e,t,n,r){var o=this,i=null;"function"==typeof e.tree&&(e=e.tree());var s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){var a=this.addHandler(function(e){i&&o.deleteTimedHandler(i);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){var s=new Error("Got bad IQ type of ".concat(r));throw s.name="StropheError",s}n&&n(e)}},null,"iq",["error","result"],s);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(a),n&&n(null),!1}))}return this.send(e),s},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return e._onIdle()},100)},addTimedHandler:function(e,t){var n=new $.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,r,o,i,s){var a=new $.Handler(e,t,n,r,o,i,s);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},e=e||[$.SASLAnonymous,$.SASLExternal,$.SASLOAuthBearer,$.SASLXOAuth2,$.SASLPlain,$.SASLSHA1],e.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus($.Status.DISCONNECTING,e),e?$.warn("Disconnect was called because: "+e):$.info("Disconnect was called"),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=x({xmlns:$.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else $.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,n){for(var r in $._connectionPlugins)if(Object.prototype.hasOwnProperty.call($._connectionPlugins,r)){var o=this[r];if(o.statusChanged)try{o.statusChanged(e,t)}catch(e){$.error("".concat(r," plugin caused an exception changing status: ").concat(e))}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){$._handleError(e),$.error("User connection callback caused an exception: ".concat(e))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),$.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus($.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){var n=this;$.debug("_dataRecv called");var r=this._proto._reqToData(e);if(null!==r){for(this.xmlInput!==$.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==$.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput($.serialize(r)));this.removeHandlers.length>0;){var o=this.removeHandlers.pop(),i=this.handlers.indexOf(o);i>=0&&this.handlers.splice(i,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var s=r.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;var a=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus($.Status.CONNFAIL,a)):this._changeConnectStatus($.Status.CONNFAIL,$.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}$.forEachChild(r,null,function(e){var t=n.handlers;n.handlers=[];for(var r=0;r<t.length;r++){var o=t[r];try{!o.isMatch(e)||!n.authenticated&&o.user?n.handlers.push(o):o.run(e)&&n.handlers.push(o)}catch(e){$.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){$.debug("_connect_cb was called"),this.connected=!0;var r;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==$.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus($.Status.CONNFAIL,$.ErrorCondition.BAD_FORMAT),this._doDisconnect($.ErrorCondition.BAD_FORMAT)}if(r){this.xmlInput!==$.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==$.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput($.serialize(r)));if(this._proto._connect_cb(r)!==$.Status.CONNFAIL){if(!(r.getElementsByTagNameNS?r.getElementsByTagNameNS($.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0))return void this._proto._no_auth_received(t);var o=[],i=r.getElementsByTagName("mechanism");if(i.length>0)for(var s=0;s<i.length;s++){var a=$.getText(i[s]);this.mechanisms[a]&&o.push(this.mechanisms[a])}if(0===o.length&&0===r.getElementsByTagName("auth").length)return void this._proto._no_auth_received(t);!1!==this.do_authentication&&this.authenticate(o)}}},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var n=t,r=t+1;r<e.length;++r)e[r].prototype.priority>e[n].prototype.priority&&(n=r);if(n!==t){var o=e[t];e[t]=e[n],e[n]=o}}return e},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=!1,n=0;n<e.length;++n)if(e[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[n],this._sasl_mechanism.onStart(this);var r=E("auth",{xmlns:$.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);r.t(B(o))}this.send(r.tree()),t=!0;break}return t},_sasl_challenge_cb:function(e){var t=M($.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),r=E("response",{xmlns:$.NS.SASL});return""!==n&&r.t(B(n)),this.send(r.tree()),!0},_attemptLegacyAuth:function(){null===$.getNodeFromJid(this.jid)?(this._changeConnectStatus($.Status.CONNFAIL,$.ErrorCondition.MISSING_JID_NODE),this.disconnect($.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus($.Status.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(T({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:$.NS.AUTH}).c("username",{}).t($.getNodeFromJid(this.jid)).tree()))},_onLegacyAuthIQResult:function(e){var t=T({type:"set",id:"_auth_2"}).c("query",{xmlns:$.NS.AUTH}).c("username",{}).t($.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return $.getResourceFromJid(this.jid)||(this.jid=$.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t($.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var n,r=M($.getText(e)),o=/([a-z]+)=([^,]+)(,|$)/,i=r.match(o);if("v"===i[1]&&(n=i[2]),n!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}$.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var s=[],a=function(e,n){for(;e.length;)t.deleteHandler(e.pop());return t._onStreamFeaturesAfterSASL(n),!1};return s.push(this._addSysHandler(function(e){return a(s,e)},null,"stream:features",null,null)),s.push(this._addSysHandler(function(e){return a(s,e)},$.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_onStreamFeaturesAfterSASL:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus($.Status.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus($.Status.AUTHFAIL,null),!1)},bind:function(){if(!this.do_bind)return void $.log($.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");var e=$.getResourceFromJid(this.jid);e?this.send(T({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:$.NS.BIND}).c("resource",{}).t(e).tree()):this.send(T({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:$.NS.BIND}).tree())},_onResourceBindResultIQ:function(e){if("error"===e.getAttribute("type")){$.warn("Resource binding failed.");var t,n=e.getElementsByTagName("conflict");return n.length>0&&(t=$.ErrorCondition.CONFLICT),this._changeConnectStatus($.Status.AUTHFAIL,t,e),!1}var r=e.getElementsByTagName("bind");if(!(r.length>0))return $.warn("Resource binding failed."),this._changeConnectStatus($.Status.AUTHFAIL,null,e),!1;var o=r[0].getElementsByTagName("jid");o.length>0&&(this.jid=$.getText(o[0]),this.do_session?this._establishSession():(this.authenticated=!0,this._changeConnectStatus($.Status.CONNECTED,null)))},_establishSession:function(){if(!this.do_session)throw new Error("Strophe.Connection.prototype._establishSession "+"called but apparently ".concat($.NS.SESSION," wasn't advertised by the server"))
;this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(T({type:"set",id:"_session_auth_2"}).c("session",{xmlns:$.NS.SESSION}).tree())},_onSessionResultIQ:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus($.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return $.warn("Session creation failed."),this._changeConnectStatus($.Status.AUTHFAIL,null,e),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus($.Status.AUTHFAIL,null,e),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus($.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus($.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new $.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,r,o){var i=new $.Handler(e,t,n,r,o);return i.user=!1,this.addHandlers.push(i),i},_onDisconnectTimeout:function(){return $.debug("_onDisconnectTimeout was called"),this._changeConnectStatus($.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),n=this.timedHandlers.indexOf(t);n>=0&&this.timedHandlers.splice(n,1)}for(var r=(new Date).getTime(),o=[],i=0;i<this.timedHandlers.length;i++){var s=this.timedHandlers[i];if(this.authenticated||!s.user){s.lastCalled+s.period-r<=0?s.run()&&o.push(s):o.push(s)}}this.timedHandlers=o,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return e._onIdle()},100))}},$.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},$.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},$.SASLAnonymous=function(){},$.SASLAnonymous.prototype=new $.SASLMechanism("ANONYMOUS",!1,20),$.SASLAnonymous.prototype.test=function(e){return null===e.authcid},$.SASLPlain=function(){},$.SASLPlain.prototype=new $.SASLMechanism("PLAIN",!0,50),$.SASLPlain.prototype.test=function(e){return null!==e.authcid},$.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,X.utf16to8(t)},$.SASLSHA1=function(){},$.SASLSHA1.prototype=new $.SASLMechanism("SCRAM-SHA-1",!0,60),$.SASLSHA1.prototype.test=function(e){return null!==e.authcid},$.SASLSHA1.prototype.onChallenge=function(e,t,n){var r=n||J.hexdigest(""+1234567890*Math.random()),o="n="+X.utf16to8(e.authcid);return o+=",r=",o+=r,e._sasl_data.cnonce=r,e._sasl_data["client-first-message-bare"]=o,o="n,,"+o,this.onChallenge=function(e,t){for(var n,r,o,i,s,a,c,u,l="c=biws,",h="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),d=e._sasl_data.cnonce,p=/([a-z]+)=([^,]+)(,|$)/;t.match(p);){var f=t.match(p);switch(t=t.replace(f[0],""),f[1]){case"r":n=f[2];break;case"s":r=f[2];break;case"i":o=f[2]}}if(n.substr(0,d.length)!==d)return e._sasl_data={},e._sasl_failure_cb();l+="r="+n,h+=l,r=M(r),r+="\0\0\0";var m=X.utf16to8(e.pass);for(i=a=z.core_hmac_sha1(m,r),c=1;c<o;c++){for(s=z.core_hmac_sha1(m,z.binb2str(a)),u=0;u<5;u++)i[u]^=s[u];a=s}i=z.binb2str(i);var _=z.core_hmac_sha1(i,"Client Key"),g=z.str_hmac_sha1(i,"Server Key"),y=z.core_hmac_sha1(z.str_sha1(z.binb2str(_)),h);for(e._sasl_data["server-signature"]=z.b64_hmac_sha1(g,h),u=0;u<5;u++)_[u]^=y[u];return l+=",p="+B(z.binb2str(_))},o},$.SASLOAuthBearer=function(){},$.SASLOAuthBearer.prototype=new $.SASLMechanism("OAUTHBEARER",!0,40),$.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},$.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",X.utf16to8(t)},$.SASLExternal=function(){},$.SASLExternal.prototype=new $.SASLMechanism("EXTERNAL",!0,10),$.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},$.SASLXOAuth2=function(){},$.SASLXOAuth2.prototype=new $.SASLMechanism("X-OAUTH2",!0,30),$.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},$.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,X.utf16to8(t)};var Q={Strophe:$,$build:E,$iq:T,$msg:S,$pres:x,SHA1:z,MD5:J,b64_hmac_sha1:z.b64_hmac_sha1,b64_sha1:z.b64_sha1,str_hmac_sha1:z.str_hmac_sha1,str_sha1:z.str_sha1},K=Q.Strophe,V=Q.$build;K.Request=function(e,t,n,r){this.id=++K._requestId,this.xmlData=e,this.data=K.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},K.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw K.error("invalid response received"),K.error("responseText: "+this.xhr.responseText),K.error("responseXML: "+K.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(K.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new O).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){K.error("invalid response received: "+e.querySelector("parsererror").textContent),K.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=K.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},K.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},K.Bosh.prototype={strip:null,_buildBody:function(){var e=V("body",{rid:this.rid++,xmlns:K.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":K.NS.BOSH});n&&r.attrs({route:n});var o=this._conn._connect_cb;this._requests.push(new K.Request(r.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,n,r,o,i,s){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=K.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=i||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(K.Status.ATTACHED,null)},_restore:function(e,t,n,r,o){var i=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==i&&null!==i&&i.rid&&i.sid&&i.jid&&(void 0===e||null===e||K.getBareJidFromJid(i.jid)===K.getBareJidFromJid(e)||null===K.getNodeFromJid(e)&&K.getDomainFromJid(i.jid)===e))){var s=new Error("_restore: no restoreable session.");throw s.name="StropheSessionError",s}this._conn.restored=!0,this._attach(i.jid,i.sid,i.rid,t,n,r,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var n=e.getAttribute("condition");K.error("BOSH-Connection failed: "+n);var r=e.getElementsByTagName("conflict");return null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(K.Status.CONNFAIL,n)):this._conn._changeConnectStatus(K.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),K.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var i=e.getAttribute("hold");i&&(this.hold=parseInt(i,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10));var a=e.getAttribute("inactivity");a&&(this.inactivity=parseInt(a,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),n=this._conn.protocolErrorHandlers.HTTP[t];n&&n.call(this,t)},_hitError:function(e){this.errors++,K.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){K.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new K.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(K.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":K.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new K.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(K.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(K.TIMEOUT*this.wait)&&(K.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(K.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){K.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n},_onRequestStateChange:function(e,t){if(K.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4===t.xhr.readyState){var n=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&n>=400)return this._hitError(n),void this._callProtocolErrorHandlers(t);var r=n>0&&n<500,o=t.sends>this._conn.maxRetries;if((r||o)&&(this._removeRequest(t),K.debug("request id "+t.id+" should now be removed")),200===n){var i=this._requests[0]===t;(this._requests[1]===t||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(K.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),K.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===n||n>=400&&n<600||n>=12e3?(K.error("request id "+t.id+"."+t.sends+" error "+n+" happened"),this._hitError(n),this._callProtocolErrorHandlers(t),n>=400&&n<500&&(this._conn._changeConnectStatus(K.Status.DISCONNECTING,null),this._conn._doDisconnect())):K.error("request id "+t.id+"."+t.sends+" error "+n+" happened");r||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(K.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,n=this._requests[e],r=this._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var o=n.age(),i=!isNaN(o)&&o>Math.floor(K.TIMEOUT*this.wait),s=null!==n.dead&&n.timeDead()>Math.floor(K.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(r<1||r>=500);if((i||s||a)&&(s&&K.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[e]=new K.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[e]),0===n.xhr.readyState){K.debug("request id "+n.id+"."+n.sends+" posting");try{var c=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",c),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return K.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(K.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(n.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.xhr.setRequestHeader(r,e[r])}n.xhr.send(n.data)};if(n.sends>1){var l=1e3*Math.min(Math.floor(K.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout(function(){u()},l)}else u();n.sends++,this._conn.xmlOutput!==K.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==K.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else K.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+n.xhr.readyState)},_removeRequest:function(e){K.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){K.debug("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var n=new K.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return e._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?K.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):K.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};var Y=Q.Strophe,Z=Q.$build;return Y.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},Y.Websocket.prototype={_buildStream:function(){return Z("open",{xmlns:Y.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(Y.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;for(var r=n[0],o="",i="",s=0;s<r.childNodes.length;s++){var a=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==a.getAttribute("xmlns"))break;"text"===a.nodeName?i=a.textContent:o=a.nodeName}var c="WebSocket stream error: ";return c+=o||"unknown",i&&(c+=" - "+i),Y.error(c),this._conn._changeConnectStatus(t,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new I(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,Y.Status.CONNFAIL))return Y.Status.CONNFAIL},_handleStreamStart:function(e){var t=!1,n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==Y.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(Y.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var n=(new O).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){var r=(new O).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data);var o=r.getAttribute("see-other-uri");if(o){var i=this._conn.service,s=i.indexOf("wss:")>=0&&o.indexOf("wss:")>=0||i.indexOf("ws:")>=0;s&&(this._conn._changeConnectStatus(Y.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect())}else this._conn._changeConnectStatus(Y.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var a=this._streamWrap(e.data),c=(new O).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==I.CLOSED){e&&this._conn.send(e);var t=Z("close",{xmlns:Y.NS.FRAMING});this._conn.xmlOutput(t.tree());var n=Y.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){Y.warn("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Y.debug("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){Y.debug(e.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(Y.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(Y.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(Y.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):Y.debug("Websocket closed")},_no_auth_received:function(e){Y.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(Y.Status.CONNFAIL,Y.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){Y.error("Websocket error "+e),this._conn._changeConnectStatus(Y.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var n=void 0;n="restart"===e[t]?this._buildStream().tree():e[t];var r=Y.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var t,n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new O).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var r=this._streamWrap(e.data);t=(new O).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(t,Y.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Y.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){Y.debug("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=Y.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},C.Strophe=Q.Strophe,C.$build=Q.$build,C.$iq=Q.$iq,C.$msg=Q.$msg,C.$pres=Q.$pres,Q})}).call(t,function(){return this}())},function(e,t){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){function r(e){this.options=e||{locator:{}}}function o(e,t,n){function r(t){var r=e[t];!r&&s&&(r=2==e.length?function(n){e(t,n)}:e),o[t]=r&&function(e){r("[xmldom "+t+"]\t"+e+a(n))}||function(){}}if(!e){if(t instanceof i)return t;e=t}var o={},s=e instanceof Function;return n=n||{},r("warning"),r("error"),r("fatalError"),o}function i(){this.cdata=!1}function s(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function a(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function c(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function u(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}r.prototype.parseFromString=function(e,t){var n=this.options,r=new l,s=n.domBuilder||new i,a=n.errorHandler,c=n.locator,u=n.xmlns||{},h={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return c&&s.setDocumentLocator(c),r.errorHandler=o(a,s,c),r.domBuilder=n.domBuilder||s,/\/x?html?$/.test(t)&&(h.nbsp=" ",h.copy="©",u[""]="http://www.w3.org/1999/xhtml"),u.xml=u.xml||"http://www.w3.org/XML/1998/namespace",e?r.parse(e,u,h):r.errorHandler.error("invalid doc source"),s.doc},i.prototype={startDocument:function(){this.doc=(new h).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var o=this.doc,i=o.createElementNS(e,n||t),a=r.length;u(this,i),this.currentElement=i,this.locator&&s(this.locator,i);for(var c=0;c<a;c++){var e=r.getURI(c),l=r.getValue(c),n=r.getQName(c),h=o.createAttributeNS(e,n);this.locator&&s(r.getLocator(c),h),h.value=h.nodeValue=l,i.setAttributeNode(h)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.doc.createProcessingInstruction(e,t);this.locator&&s(this.locator,n),u(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=c.apply(this,arguments)){if(this.cdata)var r=this.doc.createCDATASection(e);else var r=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(r):/^\s*$/.test(e)&&this.doc.appendChild(r),this.locator&&s(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=c.apply(this,arguments);var r=this.doc.createComment(e);this.locator&&s(this.locator,r),u(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.doc.implementation;if(r&&r.createDocumentType){var o=r.createDocumentType(e,t,n);this.locator&&s(this.locator,o),u(this,o)}},warning:function(e){console.warn("[xmldom warning]\t"+e,a(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,a(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,a(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){i.prototype[e]=function(){return null}});var l=n(5).XMLReader,h=t.DOMImplementation=n(6).DOMImplementation;t.XMLSerializer=n(6).XMLSerializer,t.DOMParser=r},function(e,t){function n(){}function r(e,t,n,r,u){function p(e){if(e>65535){e-=65536;var t=55296+(e>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function f(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?p(parseInt(t.substr(1).replace("x","0x"))):(u.error("entity not found:"+e),e)}function m(t){if(t>S){var n=e.substring(S,t).replace(/&#?\w+;/g,f);N&&_(S),r.characters(n,0,t-S),S=t}}function _(t,n){for(;t>=y&&(n=v.exec(e));)g=n.index,y=g+n[0].length,N.lineNumber++;N.columnNumber=t-g+1}for(var g=0,y=0,v=/.*(?:\r\n?|\n)|.*$/g,N=r.locator,b=[{currentNSMap:t}],E={},S=0;;){try{var T=e.indexOf("<",S);if(T<0){if(!e.substr(S).match(/^\s*$/)){var x=r.doc,C=x.createTextNode(e.substr(S));x.appendChild(C),r.currentElement=C}return}switch(T>S&&m(T),e.charAt(T+1)){case"/":var I=e.indexOf(">",T+3),O=e.substring(T+2,I),w=b.pop();I<0?(O=e.substring(T+2).replace(/[\s<].*/,""),u.error("end tag name: "+O+" is not complete:"+w.tagName),I=T+1+O.length):O.match(/\s</)&&(O=O.replace(/[\s<].*/,""),u.error("end tag name: "+O+" maybe not complete"),I=T+1+O.length);var R=w.localNSMap,A=w.tagName==O;if(A||w.tagName&&w.tagName.toLowerCase()==O.toLowerCase()){if(r.endElement(w.uri,w.localName,O),R)for(var M in R)r.endPrefixMapping(M);A||u.fatalError("end tag name: "+O+" is not match the current start tagName:"+w.tagName)}else b.push(w);I++;break;case"?":N&&_(T),I=h(e,T,r);break;case"!":N&&_(T),I=l(e,T,r,u);break;default:N&&_(T);var B=new d,D=b[b.length-1].currentNSMap,I=i(e,T,B,D,f,u),k=B.length;if(!B.closed&&c(e,I,B.tagName,E)&&(B.closed=!0,n.nbsp||u.warning("unclosed xml attribute")),N&&k){for(var j=o(N,{}),L=0;L<k;L++){var F=B[L];_(F.offset),F.locator=o(N,{})}r.locator=j,s(B,r,D)&&b.push(B),r.locator=N}else s(B,r,D)&&b.push(B);"http://www.w3.org/1999/xhtml"!==B.uri||B.closed?I++:I=a(e,I,B.tagName,f,r)}}catch(e){u.error("element parse error: "+e),I=-1}I>S?S=I:m(Math.max(T,S)+1)}}function o(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function i(e,t,n,r,o,i){for(var s,a,c=++t,u=y;;){var l=e.charAt(c);switch(l){case"=":if(u===v)s=e.slice(t,c),u=b;else{if(u!==N)throw new Error("attribute equal must after attrName");u=b}break;case"'":case'"':if(u===b||u===v){if(u===v&&(i.warning('attribute value must after "="'),s=e.slice(t,c)),t=c+1,!((c=e.indexOf(l,t))>0))throw new Error("attribute value no end '"+l+"' match");a=e.slice(t,c).replace(/&#?\w+;/g,o),n.add(s,a,t-1),u=S}else{if(u!=E)throw new Error('attribute value must after "="');a=e.slice(t,c).replace(/&#?\w+;/g,o),n.add(s,a,t),i.warning('attribute "'+s+'" missed start quot('+l+")!!"),t=c+1,u=S}break;case"/":switch(u){case y:n.setTagName(e.slice(t,c));case S:case T:case x:u=x,n.closed=!0;case E:case v:case N:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),u==y&&n.setTagName(e.slice(t,c)),c;case">":switch(u){case y:n.setTagName(e.slice(t,c));case S:case T:case x:break;case E:case v:a=e.slice(t,c),"/"===a.slice(-1)&&(n.closed=!0,a=a.slice(0,-1));case N:u===N&&(a=s),u==E?(i.warning('attribute "'+a+'" missed quot(")!!'),n.add(s,a.replace(/&#?\w+;/g,o),t)):("http://www.w3.org/1999/xhtml"===r[""]&&a.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+a+'" missed value!! "'+a+'" instead!!'),n.add(a,a,t));break;case b:throw new Error("attribute value missed!!")}return c;case"":l=" ";default:if(l<=" ")switch(u){case y:n.setTagName(e.slice(t,c)),u=T;break;case v:s=e.slice(t,c),u=N;break;case E:var a=e.slice(t,c).replace(/&#?\w+;/g,o);i.warning('attribute "'+a+'" missed quot(")!!'),n.add(s,a,t);case S:u=T}else switch(u){case N:n.tagName;"http://www.w3.org/1999/xhtml"===r[""]&&s.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+s+'" missed value!! "'+s+'" instead2!!'),n.add(s,s,t),t=c,u=v;break;case S:i.warning('attribute space is required"'+s+'"!!');case T:u=v,t=c;break;case b:u=E,t=c;break;case x:throw new Error("elements closed character '/' and '>' must be connected to")}}c++}}function s(e,t,n){for(var r=e.tagName,o=null,i=e.length;i--;){var s=e[i],a=s.qName,c=s.value,l=a.indexOf(":");if(l>0)var h=s.prefix=a.slice(0,l),d=a.slice(l+1),p="xmlns"===h&&d;else d=a,h=null,p="xmlns"===a&&"";s.localName=d,!1!==p&&(null==o&&(o={},u(n,n={})),n[p]=o[p]=c,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,c))}for(var i=e.length;i--;){s=e[i];var h=s.prefix;h&&("xml"===h&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==h&&(s.uri=n[h||""]))}var l=r.indexOf(":");l>0?(h=e.prefix=r.slice(0,l),d=e.localName=r.slice(l+1)):(h=null,d=e.localName=r);var f=e.uri=n[h||""];if(t.startElement(f,d,r,e),!e.closed)return e.currentNSMap=n,e.localNSMap=o,!0;if(t.endElement(f,d,r),o)for(h in o)t.endPrefixMapping(h)}function a(e,t,n,r,o){if(/^(?:script|textarea)$/i.test(n)){var i=e.indexOf("</"+n+">",t),s=e.substring(t+1,i);if(/[&<]/.test(s))return/^script$/i.test(n)?(o.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,r),o.characters(s,0,s.length),i)}return t+1}function c(e,t,n,r){var o=r[n];return null==o&&(o=e.lastIndexOf("</"+n+">"),o<t&&(o=e.lastIndexOf("</"+n)),r[n]=o),o<t}function u(e,t){for(var n in e)t[n]=e[n]}function l(e,t,n,r){switch(e.charAt(t+2)){case"-":if("-"===e.charAt(t+3)){var o=e.indexOf("--\x3e",t+4);return o>t?(n.comment(e,t+4,o-t-4),o+3):(r.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var o=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,o-t-9),n.endCDATA(),o+3}var i=f(e,t),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var a=i[1][0],c=s>3&&/^public$/i.test(i[2][0])&&i[3][0],u=s>4&&i[4][0],l=i[s-1];return n.startDTD(a,c&&c.replace(/^(['"])(.*?)\1$/,"$2"),u&&u.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),l.index+l[0].length}}return-1}function h(e,t,n){var r=e.indexOf("?>",t);if(r){var o=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(o){o[0].length;return n.processingInstruction(o[1],o[2]),r+2}return-1}return-1}function d(e){}function p(e,t){return e.__proto__=t,e}function f(e,t){
var n,r=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(o.lastIndex=t,o.exec(e);n=o.exec(e);)if(r.push(n),n[1])return r}var m=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,_=new RegExp("[\\-\\.0-9"+m.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),g=new RegExp("^"+m.source+_.source+"*(?::"+m.source+_.source+"*)?$"),y=0,v=1,N=2,b=3,E=4,S=5,T=6,x=7;n.prototype={parse:function(e,t,n){var o=this.domBuilder;o.startDocument(),u(t,t={}),r(e,t,n,o,this.errorHandler),o.endDocument()}},d.prototype={setTagName:function(e){if(!g.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,n){if(!g.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},p({},p.prototype)instanceof p||(p=function(e,t){function n(){}n.prototype=t,n=new n;for(t in e)n[t]=e[t];return n}),t.XMLReader=n},function(e,t){function n(e,t){for(var n in e)t[n]=e[n]}function r(e,t){function r(){}var o=e.prototype;if(Object.create){var i=Object.create(t.prototype);o.__proto__=i}o instanceof t||(r.prototype=t.prototype,r=new r,n(o,r),e.prototype=o=r),o.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),o.constructor=e)}function o(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,oe[e]),this.message=oe[e],Error.captureStackTrace&&Error.captureStackTrace(this,o);return n.code=e,t&&(this.message=this.message+": "+t),n}function i(){}function s(e,t){this._node=e,this._refresh=t,a(this)}function a(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);W(e,"length",r.length),n(r,e),e._inc=t}}function c(){}function u(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function l(e,t,n,r){if(r?t[u(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var o=e.ownerDocument;o&&(r&&y(o,e,r),g(o,e,n))}}function h(e,t,n){var r=u(t,n);if(!(r>=0))throw o(se,new Error(e.tagName+"@"+n));for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var s=e.ownerDocument;s&&(y(s,e,n),n.ownerElement=null)}}function d(e){if(this._features={},e)for(var t in e)this._features=e[t]}function p(){}function f(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function m(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(m(e,t))return!0}while(e=e.nextSibling)}function _(){}function g(e,t,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function y(e,t,n,r){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==n.namespaceURI&&delete t._nsMap[n.prefix?n.localName:""]}function v(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var o=t.firstChild,i=0;o;)r[i++]=o,o=o.nextSibling;r.length=i}}}function N(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,v(e.ownerDocument,e),t}function b(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===te){var o=t.firstChild;if(null==o)return t;var i=t.lastChild}else o=i=t;var s=n?n.previousSibling:e.lastChild;o.previousSibling=s,i.nextSibling=n,s?s.nextSibling=o:e.firstChild=o,null==n?e.lastChild=i:n.previousSibling=i;do{o.parentNode=e}while(o!==i&&(o=o.nextSibling));return v(e.ownerDocument||e,e),t.nodeType==te&&(t.firstChild=t.lastChild=null),t}function E(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t);var r=e.lastChild}var r=e.lastChild;return t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,v(e.ownerDocument,e,t),t}function S(){this._nsMap={}}function T(){}function x(){}function C(){}function I(){}function O(){}function w(){}function R(){}function A(){}function M(){}function B(){}function D(){}function k(){}function j(e,t){var n=[],r=9==this.nodeType?this.documentElement:this,o=r.prefix,i=r.namespaceURI;if(i&&null==o){var o=r.lookupPrefix(i);if(null==o)var s=[{namespace:i,prefix:null}]}return F(this,n,e,t,s),n.join("")}function L(e,t,n){var r=e.prefix||"",o=e.namespaceURI;if(!r&&!o)return!1;if("xml"===r&&"http://www.w3.org/XML/1998/namespace"===o||"http://www.w3.org/2000/xmlns/"==o)return!1;for(var i=n.length;i--;){var s=n[i];if(s.prefix==r)return s.namespace!=o}return!0}function F(e,t,n,r,o){if(r){if(!(e=r(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case J:o||(o=[]);var i=(o.length,e.attributes),s=i.length,a=e.firstChild,c=e.tagName;n=G===e.namespaceURI||n,t.push("<",c);for(var u=0;u<s;u++){var l=i.item(u);"xmlns"==l.prefix?o.push({prefix:l.localName,namespace:l.value}):"xmlns"==l.nodeName&&o.push({prefix:"",namespace:l.value})}for(var u=0;u<s;u++){var l=i.item(u);if(L(l,n,o)){var h=l.prefix||"",d=l.namespaceURI,p=h?" xmlns:"+h:" xmlns";t.push(p,'="',d,'"'),o.push({prefix:h,namespace:d})}F(l,t,n,r,o)}if(L(e,n,o)){var h=e.prefix||"",d=e.namespaceURI,p=h?" xmlns:"+h:" xmlns";t.push(p,'="',d,'"'),o.push({prefix:h,namespace:d})}if(a||n&&!/^(?:meta|link|img|br|hr|input)$/i.test(c)){if(t.push(">"),n&&/^script$/i.test(c))for(;a;)a.data?t.push(a.data):F(a,t,n,r,o),a=a.nextSibling;else for(;a;)F(a,t,n,r,o),a=a.nextSibling;t.push("</",c,">")}else t.push("/>");return;case Z:case te:for(var a=e.firstChild;a;)F(a,t,n,r,o),a=a.nextSibling;return;case z:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,f),'"');case X:return t.push(e.data.replace(/[<&]/g,f));case $:return t.push("<![CDATA[",e.data,"]]>");case Y:return t.push("\x3c!--",e.data,"--\x3e");case ee:var m=e.publicId,_=e.systemId;if(t.push("<!DOCTYPE ",e.name),m)t.push(' PUBLIC "',m),_&&"."!=_&&t.push('" "',_),t.push('">');else if(_&&"."!=_)t.push(' SYSTEM "',_,'">');else{var g=e.internalSubset;g&&t.push(" [",g,"]"),t.push(">")}return;case V:return t.push("<?",e.target," ",e.data,"?>");case Q:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function H(e,t,n){var r;switch(t.nodeType){case J:r=t.cloneNode(!1),r.ownerDocument=e;case te:break;case z:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var o=t.firstChild;o;)r.appendChild(H(e,o,n)),o=o.nextSibling;return r}function U(e,t,n){var r=new t.constructor;for(var o in t){var s=t[o];"object"!=typeof s&&s!=r[o]&&(r[o]=s)}switch(t.childNodes&&(r.childNodes=new i),r.ownerDocument=e,r.nodeType){case J:var a=t.attributes,u=r.attributes=new c,l=a.length;u._ownerElement=r;for(var h=0;h<l;h++)r.setAttributeNode(U(e,a.item(h),!0));break;case z:n=!0}if(n)for(var d=t.firstChild;d;)r.appendChild(U(e,d,n)),d=d.nextSibling;return r}function W(e,t,n){e[t]=n}function q(e){switch(e.nodeType){case J:case te:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(q(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}var G="http://www.w3.org/1999/xhtml",P={},J=P.ELEMENT_NODE=1,z=P.ATTRIBUTE_NODE=2,X=P.TEXT_NODE=3,$=P.CDATA_SECTION_NODE=4,Q=P.ENTITY_REFERENCE_NODE=5,K=P.ENTITY_NODE=6,V=P.PROCESSING_INSTRUCTION_NODE=7,Y=P.COMMENT_NODE=8,Z=P.DOCUMENT_NODE=9,ee=P.DOCUMENT_TYPE_NODE=10,te=P.DOCUMENT_FRAGMENT_NODE=11,ne=P.NOTATION_NODE=12,re={},oe={},ie=(re.INDEX_SIZE_ERR=(oe[1]="Index size error",1),re.DOMSTRING_SIZE_ERR=(oe[2]="DOMString size error",2),re.HIERARCHY_REQUEST_ERR=(oe[3]="Hierarchy request error",3)),se=(re.WRONG_DOCUMENT_ERR=(oe[4]="Wrong document",4),re.INVALID_CHARACTER_ERR=(oe[5]="Invalid character",5),re.NO_DATA_ALLOWED_ERR=(oe[6]="No data allowed",6),re.NO_MODIFICATION_ALLOWED_ERR=(oe[7]="No modification allowed",7),re.NOT_FOUND_ERR=(oe[8]="Not found",8)),ae=(re.NOT_SUPPORTED_ERR=(oe[9]="Not supported",9),re.INUSE_ATTRIBUTE_ERR=(oe[10]="Attribute in use",10));re.INVALID_STATE_ERR=(oe[11]="Invalid state",11),re.SYNTAX_ERR=(oe[12]="Syntax error",12),re.INVALID_MODIFICATION_ERR=(oe[13]="Invalid modification",13),re.NAMESPACE_ERR=(oe[14]="Invalid namespace",14),re.INVALID_ACCESS_ERR=(oe[15]="Invalid access",15);o.prototype=Error.prototype,n(re,o),i.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var n=[],r=0;r<this.length;r++)F(this[r],n,e,t);return n.join("")}},s.prototype.item=function(e){return a(this),this[e]},r(s,i),c.prototype={length:0,item:i.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new o(ae);var n=this.getNamedItem(e.nodeName);return l(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new o(ae);return t=this.getNamedItemNS(e.namespaceURI,e.localName),l(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return h(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return h(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},d.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new _;if(r.implementation=this,r.childNodes=new i,r.doctype=n,n&&r.appendChild(n),t){var o=r.createElementNS(e,t);r.appendChild(o)}return r},createDocumentType:function(e,t,n){var r=new w;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},p.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return b(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return N(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return U(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==X&&e.nodeType==X?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=t.nodeType==z?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=t.nodeType==z?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},n(P,p),n(P,p.prototype),_.prototype={nodeName:"#document",nodeType:Z,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==te){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&e.nodeType==J&&(this.documentElement=e),b(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),N(this,e)},importNode:function(e,t){return H(this,e,t)},getElementById:function(e){var t=null;return m(this.documentElement,function(n){if(n.nodeType==J&&n.getAttribute("id")==e)return t=n,!0}),t},createElement:function(e){var t=new S;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new i,(t.attributes=new c)._ownerElement=t,t},createDocumentFragment:function(){var e=new B;return e.ownerDocument=this,e.childNodes=new i,e},createTextNode:function(e){var t=new C;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new I;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new O;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new D;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new T;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new M;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new S,r=t.split(":"),o=n.attributes=new c;return n.childNodes=new i,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,o._ownerElement=n,n},createAttributeNS:function(e,t){var n=new T,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},r(_,p),S.prototype={nodeType:J,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===te?this.insertBefore(e,null):E(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new s(this,function(t){var n=[];return m(t,function(r){r===t||r.nodeType!=J||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new s(this,function(n){var r=[];return m(n,function(o){o===n||o.nodeType!==J||"*"!==e&&o.namespaceURI!==e||"*"!==t&&o.localName!=t||r.push(o)}),r})}},_.prototype.getElementsByTagName=S.prototype.getElementsByTagName,_.prototype.getElementsByTagNameNS=S.prototype.getElementsByTagNameNS,r(S,p),T.prototype.nodeType=z,r(T,p),x.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(oe[ie])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){n=this.data.substring(0,e)+n+this.data.substring(e+t),this.nodeValue=this.data=n,this.length=n.length}},r(x,p),C.prototype={nodeName:"#text",nodeType:X,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},r(C,x),I.prototype={nodeName:"#comment",nodeType:Y},r(I,x),O.prototype={nodeName:"#cdata-section",nodeType:$},r(O,x),w.prototype.nodeType=ee,r(w,p),R.prototype.nodeType=ne,r(R,p),A.prototype.nodeType=K,r(A,p),M.prototype.nodeType=Q,r(M,p),B.prototype.nodeName="#document-fragment",B.prototype.nodeType=te,r(B,p),D.prototype.nodeType=V,r(D,p),k.prototype.serializeToString=function(e,t,n){return j.call(e,t,n)},p.prototype.toString=j;try{Object.defineProperty&&(Object.defineProperty(s.prototype,"length",{get:function(){return a(this),this.$$length}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return q(this)},set:function(e){switch(this.nodeType){case J:case te:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),W=function(e,t,n){e["$$"+t]=n})}catch(e){}t.DOMImplementation=d,t.XMLSerializer=k},function(e,t){!function(){t.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:0,WEBIM_CONNCTION_OPEN_ERROR:1,WEBIM_CONNCTION_AUTH_ERROR:2,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:3,WEBIM_CONNCTION_ATTACH_ERROR:4,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:5,WEBIM_CONNCTION_REOPEN_ERROR:6,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:7,WEBIM_CONNCTION_SERVER_ERROR:8,WEBIM_CONNCTION_IQ_ERROR:9,WEBIM_CONNCTION_PING_ERROR:10,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:11,WEBIM_CONNCTION_GETROSTER_ERROR:12,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:13,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:14,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:15,WEBIM_CONNCTION_DISCONNECTED:16,WEBIM_CONNCTION_AJAX_ERROR:17,WEBIM_CONNCTION_JOINROOM_ERROR:18,WEBIM_CONNCTION_GETROOM_ERROR:19,WEBIM_CONNCTION_GETROOMINFO_ERROR:20,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:21,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:22,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:23,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:24,WEBIM_CONNCTION_JOINCHATROOM_ERROR:25,WEBIM_CONNCTION_QUITCHATROOM_ERROR:26,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:27,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:28,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:29,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:30,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:31,WEBIM_CONNCTION_CLIENT_OFFLINE:32,WEBIM_CONNCTION_CLIENT_LOGOUT:33,WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR:34,WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP:35,WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP:36,WEBIM_CONNECTION_ACCEPT_JOIN_GROUP:37,WEBIM_CONNECTION_DECLINE_JOIN_GROUP:38,WEBIM_CONNECTION_CLOSED:39,WEBIM_UPLOADFILE_BROWSER_ERROR:100,WEBIM_UPLOADFILE_ERROR:101,WEBIM_UPLOADFILE_NO_LOGIN:102,WEBIM_UPLOADFILE_NO_FILE:103,WEBIM_DOWNLOADFILE_ERROR:200,WEBIM_DOWNLOADFILE_NO_LOGIN:201,WEBIM_DOWNLOADFILE_BROWSER_ERROR:202,WEBIM_MESSAGE_REC_TEXT:300,WEBIM_MESSAGE_REC_TEXT_ERROR:301,WEBIM_MESSAGE_REC_EMOTION:302,WEBIM_MESSAGE_REC_PHOTO:303,WEBIM_MESSAGE_REC_AUDIO:304,WEBIM_MESSAGE_REC_AUDIO_FILE:305,WEBIM_MESSAGE_REC_VEDIO:306,WEBIM_MESSAGE_REC_VEDIO_FILE:307,WEBIM_MESSAGE_REC_FILE:308,WEBIM_MESSAGE_SED_TEXT:309,WEBIM_MESSAGE_SED_EMOTION:310,WEBIM_MESSAGE_SED_PHOTO:311,WEBIM_MESSAGE_SED_AUDIO:312,WEBIM_MESSAGE_SED_AUDIO_FILE:313,WEBIM_MESSAGE_SED_VEDIO:314,WEBIM_MESSAGE_SED_VEDIO_FILE:315,WEBIM_MESSAGE_SED_FILE:316,WEBIM_MESSAGE_SED_ERROR:317,STATUS_INIT:400,STATUS_DOLOGIN_USERGRID:401,STATUS_DOLOGIN_IM:402,STATUS_OPENED:403,STATUS_CLOSING:404,STATUS_CLOSED:405,STATUS_ERROR:406}}()},function(e,t,n){!function(){var e=function(){},r=n(7).code,o=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},i=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},s=function(t){t=t||!0;var n=o()||i();if("withCredentials"in n)return n;if(!t)return n;if(void 0===window.XDomainRequest)return n;var r=new XDomainRequest;return r.readyState=0,r.status=100,r.onreadystatechange=e,r.onload=function(){r.readyState=4,r.status=200;var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(r.responseText),r.responseXML=e,r.response=r.responseText,r.onreadystatechange()},r.ontimeout=r.onerror=function(){r.readyState=4,r.status=500,r.onreadystatechange()},r},a=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),c=s(),u="undefined"!=typeof FormData,l="undefined"!=typeof Blob,h=c.setRequestHeader||!1,d=c.overrideMimeType||!1,p=h&&u,f=p||a,m=h&&(l||d);Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var i,s,a=[];for(i in o)e.call(o,i)&&a.push(i);if(t)for(s=0;s<r;s++)e.call(o,n[s])&&a.push(n[s]);return a}}());var _={hasFormData:u,hasBlob:l,emptyfn:e,isCanSetRequestHeader:h,hasOverrideMimeType:d,isCanUploadFileAsync:p,isCanUploadFile:f,isCanDownLoadFile:m,isSupportWss:function(){var e=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var t=window.navigator.userAgent,n=0,r=e.length;n<r;n++)if(e[n].test(t))return!1;return!0}(),getIEVersion:function(){var e,t=navigator.userAgent,n={4:8,5:9,6:10,7:11};return(e=t.match(/MSIE (\d+)/i))&&e[1]?+e[1]:(e=t.match(/Trident\/(\d+)/i),e&&e[1]?n[e[1]]||null:null)}(),stringify:function(e){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(e);var t="",n=[],r=function(e){var o=!1;"[object Array]"===Object.prototype.toString.call(e)?(n.push("]","["),o=!0):"[object Object]"===Object.prototype.toString.call(e)&&n.push("}","{");for(var i in e)"[object Null]"===Object.prototype.toString.call(e[i])?e[i]="null":"[object Undefined]"===Object.prototype.toString.call(e[i])&&(e[i]="undefined"),e[i]&&"object"==typeof e[i]?t+=","+(o?"":'"'+i+'":'+(o?'"':""))+r(e[i]):t+=',"'+(o?"":i+'":"')+e[i]+'"';return""!=t&&(t=t.slice(1)),n.pop()+t+n.pop()};return r(e)},login:function(t){var t=t||{},n=t.success||e,o=t.error||e,i=t.appKey||"",s=i.split("#");if(2!==s.length)return o({type:r.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=s[0],c=s[1],u=u||t.https,l=t.user||"",h=t.pwd||"",d=t.apiUrl,p={grant_type:"password",username:l,password:h,timestamp:+new Date},f=_.stringify(p),t={url:d+"/"+a+"/"+c+"/token",dataType:"json",data:f,success:n,error:o};return _.ajax(t)},getFileUrl:function(e){var t={url:"",filename:"",filetype:"",data:""},n="string"==typeof e?document.getElementById(e):e;if(!_.isCanUploadFileAsync||!n)return t;try{if(window.URL.createObjectURL){var r=n.files;if(r.length>0){var o=r.item(0);t.data=o,t.url=window.URL.createObjectURL(o),t.filename=o.name||""}}else{var o=document.getElementById(e).value;t.url=o;var i=o.lastIndexOf("/"),s=o.lastIndexOf("\\"),a=Math.max(i,s);t.filename=a<0?o:o.substring(a+1)}var c=t.filename.lastIndexOf(".");return-1!=c&&(t.filetype=t.filename.substring(c+1).toLowerCase()),t}catch(e){throw e}},getFileSize:function(e){var t=this.getFileLength(e);if(t>1e7)return!1;var n=Math.round(t/1e3);if(n<1e3)t=n+" KB";else if(n>=1e3){var r=n/1e3;if(r<1e3)t=r.toFixed(1)+" MB";else{var o=r/1e3;t=o.toFixed(1)+" GB"}}return t},getFileLength:function(e){var t=0;if(e)if(e.files)e.files.length>0&&(t=e.files[0].size);else if(e.select&&"ActiveXObject"in window){e.select();var n=new ActiveXObject("Scripting.FileSystemObject"),e=n.GetFile(e.value);t=e.Size}return t},hasFlash:a,trim:function(e){return e="string"==typeof e?e:"",e.trim?e.trim():e.replace(/^\s|\s$/g,"")},parseEmoji:function(e){if(void 0===WebIM.Emoji||void 0===WebIM.Emoji.map)return e;var t=WebIM.Emoji;for(var n in t.map)if(t.map.hasOwnProperty(n))for(;e.indexOf(n)>-1;)e=e.replace(n,'<img class="emoji" src="'+t.path+t.map[n]+'" />');return e},parseLink:function(e){var t=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm;return e=e.replace(t,function(e){return"<a href='"+(/^https?/gm.test(e)?e:"//"+e)+"' target='_blank'>"+e+"</a>"})},parseJSON:function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,n=null,r=_.trim(e+"");return r&&!_.trim(r.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,r,o,i){return t&&r&&(n=0),0===n?e:(t=o||r,n+=!i-!o,"")}))?Function("return "+r)():Function("Invalid JSON: "+e)()},parseUploadResponse:function(e){return e.indexOf("callback")>-1?e.slice(9,-1):e},parseDownloadResponse:function(e){return e&&e.type&&"application/json"===e.type||0>Object.prototype.toString.call(e).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(e)},uploadFile:function(t){var t=t||{};t.onFileUploadProgress=t.onFileUploadProgress||e,t.onFileUploadComplete=t.onFileUploadComplete||e,t.onFileUploadError=t.onFileUploadError||e,t.onFileUploadCanceled=t.onFileUploadCanceled||e;var n=t.accessToken||this.context.accessToken;if(!n)return void t.onFileUploadError({type:r.WEBIM_UPLOADFILE_NO_LOGIN,id:t.id});var o,i,s,a=t.appKey||this.context.appKey||"";if(a&&(s=a.split("#"),o=s[0],i=s[1]),!o&&!i)return void t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:t.id});var c=t.apiUrl,u=c+"/"+o+"/"+i+"/chatfiles";if(!_.isCanUploadFileAsync)return void(_.hasFlash&&"function"==typeof t.flashUpload?t.flashUpload&&t.flashUpload(u,t):t.onFileUploadError({type:r.WEBIM_UPLOADFILE_BROWSER_ERROR,id:t.id}));var l=t.file.data?t.file.data.size:void 0;if(l>10485760)return void t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:t.id});if(l<=0)return void t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:t.id});var h=_.xmlrequest(),d=function(e){t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,id:t.id,xhr:h})};h.upload&&h.upload.addEventListener("progress",t.onFileUploadProgress,!1),h.addEventListener?(h.addEventListener("abort",t.onFileUploadCanceled,!1),h.addEventListener("load",function(e){try{var n=_.parseJSON(h.responseText);try{t.onFileUploadComplete(n)}catch(e){t.onFileUploadError({type:r.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}catch(e){t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h})}},!1),h.addEventListener("error",d,!1)):h.onreadystatechange&&(h.onreadystatechange=function(){if(4===h.readyState)if(200===ajax.status)try{var e=_.parseJSON(h.responseText);t.onFileUploadComplete(e)}catch(e){t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h})}else t.onFileUploadError({type:r.WEBIM_UPLOADFILE_ERROR,data:h.responseText,id:t.id,xhr:h});else h.abort(),t.onFileUploadCanceled()}),h.open("POST",u),h.setRequestHeader("restrict-access","true"),h.setRequestHeader("Accept","*/*"),h.setRequestHeader("Authorization","Bearer "+n);var p=new FormData;p.append("file",t.file.data),window.XDomainRequest&&(h.readyState=2),h.send(p)},download:function(t){t.onFileDownloadComplete=t.onFileDownloadComplete||e,t.onFileDownloadError=t.onFileDownloadError||e;var n=t.accessToken||this.context.accessToken;if(!n)return void t.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_NO_LOGIN,id:t.id});var o=function(e){t.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:i})};if(!_.isCanDownLoadFile)return void t.onFileDownloadComplete();var i=_.xmlrequest();"addEventListener"in i?(i.addEventListener("load",function(e){t.onFileDownloadComplete(i.response,i)},!1),i.addEventListener("error",o,!1)):"onreadystatechange"in i&&(i.onreadystatechange=function(){4===i.readyState?200===ajax.status?t.onFileDownloadComplete(i.response,i):t.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:i}):(i.abort(),t.onFileDownloadError({type:r.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:i}))});var s=t.method||"GET",a=t.responseType||"blob",c=t.mimeType||"text/plain; charset=x-user-defined";i.open(s,t.url),"undefined"!=typeof Blob?i.responseType=a:i.overrideMimeType(c);var u={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":t.secret,Authorization:"Bearer "+n},l=t.headers||{};for(var h in l)u[h]=l[h];for(var h in u)u[h]&&i.setRequestHeader(h,u[h]);window.XDomainRequest&&(i.readyState=2),i.send(null)},parseTextMessage:function(e,t){if("string"==typeof e){if("[object Object]"!==Object.prototype.toString.call(t))return{isemoji:!1,body:[{type:"txt",data:e}]};var n=e,r=[],o=/\[[^[\]]{2,3}\]/gm,i=n.match(o);if(!i||i.length<1)return{isemoji:!1,body:[{type:"txt",data:e}]};for(var s=!1,a=0;a<i.length;a++){var c=n.substring(0,n.indexOf(i[a])),u=WebIM.Emoji.map[i[a]];if(c&&r.push({type:"txt",data:c}),u){var l=WebIM.Emoji.map?WebIM.Emoji.path+u:null;l?(s=!0,r.push({type:"emoji",data:l})):r.push({type:"txt",data:i[a]});var h=n.indexOf(i[a])+i[a].length;n=n.substring(h)}else r.push({type:"txt",data:i[a]})}return n&&r.push({type:"txt",data:n}),s?{isemoji:s,body:r}:{isemoji:!1,body:[{type:"txt",data:e}]}}},parseUri:function(){var e=/([^\?|&])\w+=([^&]+)/g,t={};if(window.location.search){var n=window.location.search.match(e);for(var r in n){var o=n[r],i=o.indexOf("="),s=o.substr(0,i),a=o.substr(i+1);t[s]=a}}return t},parseHrefHash:function(){var e=/([^\#|&])\w+=([^&]+)/g,t={};if(window.location.hash){var n=window.location.hash.match(e);for(var r in n){var o=n[r],i=o.indexOf("="),s=o.substr(0,i),a=o.substr(i+1);t[s]=a}}return t},xmlrequest:s,getXmlFirstChild:function(e,t){var n=e.getElementsByTagName(t);return 0==n.length?null:n[0]},ajax:function(t){var n=t.dataType||"text",o=t.success||e,i=t.error||e,s=_.xmlrequest();s.onreadystatechange=function(){if(4===s.readyState){if(200===(s.status||0)){try{switch(n){case"text":return void o(s.responseText);case"json":var e=_.parseJSON(s.responseText);return void o(e,s);case"xml":return void(s.responseXML&&s.responseXML.documentElement?o(s.responseXML.documentElement,s):i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText}))}o(s.response||s.responseText,s)}catch(e){i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:e})}return}return void i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})}0===s.readyState&&i({type:r.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})},t.responseType&&s.responseType&&(s.responseType=t.responseType),t.mimeType&&_.hasOverrideMimeType&&s.overrideMimeType(t.mimeType);var a=t.type||"POST",c=t.data||null,u="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(u+=l+"="+c[l]+"&");u=u?u.slice(0,-1):u,t.url+=(t.url.indexOf("?")>0?"&":"?")+(u?u+"&":u)+"_v="+(new Date).getTime(),c=null,u=null}if(s.open(a,t.url,_.isCanSetRequestHeader),_.isCanSetRequestHeader){var h=t.headers||{};for(var d in h)h.hasOwnProperty(d)&&s.setRequestHeader(d,h[d])}return window.XDomainRequest&&(s.readyState=2),s.send(c),s},ts:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),o=e.getMilliseconds();return(t<10?"0"+t:t)+":"+(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)+":"+o+" "},getObjectKey:function(e,t){for(var n in e)if(e[n]==t)return n;return""},sprintf:function(){var e,t,n=arguments,r=n[0]||"";for(e=1,t=n.length;e<t;e++)r=r.replace(/%s/,n[e]);return r},setCookie:function(e,t,n){var r=e+"="+encodeURIComponent(t);"number"==typeof n&&(r+="; max-age: "+60*n*60*24),document.cookie=r},getCookie:function(){var e={},t=document.cookie;if(""===t)return e;for(var n=t.split("; "),r=0;r<n.length;r++){var o=n[r],i=o.indexOf("="),s=o.substring(0,i),a=o.substring(i+1);a=decodeURIComponent(a),e[s]=a}return e}};t.utils=_}()},function(e,t,n){n(10);!function(){"use strict";var e=n(8).utils,r=function(e,t){return!this instanceof r?new r(e):(this._msg={},"function"==typeof r[e]&&(r[e].prototype.setGroup=this.setGroup,this._msg=new r[e](t)),this._msg)};r.prototype.setGroup=function(e){this.body.group=e},r.read=function(e){this.id=e,this.type="read"},r.read.prototype.set=function(e){this.body={ackId:e.id,to:e.to}},r.delivery=function(e){this.id=e,this.type="delivery"},r.delivery.prototype.set=function(e){this.body={bodyId:e.id,to:e.to}},r.txt=function(e){this.id=e,this.type="txt",this.body={}},r.txt.prototype.set=function(e){this.value=e.msg,this.body={id:this.id,to:e.to,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success,fail:e.fail},!e.roomType&&delete this.body.roomType},r.cmd=function(e){this.id=e,this.type="cmd",this.body={}},r.cmd.prototype.set=function(e){this.value="",this.body={to:e.to,action:e.action,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success},!e.roomType&&delete this.body.roomType},r.location=function(e){this.id=e,this.type="loc",this.body={}},r.location.prototype.set=function(e){this.body={to:e.to,type:this.type,roomType:e.roomType,addr:e.addr,lat:e.lat,
lng:e.lng,ext:e.ext||{}}},r.img=function(e){this.id=e,this.type="img",this.body={}},r.img.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.body={id:this.id,file:this.value,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,width:t.width,height:t.height,body:t.body,uploadError:t.uploadError,uploadComplete:t.uploadComplete},!t.roomType&&delete this.body.roomType},r.audio=function(e){this.id=e,this.type="audio",this.body={}},r.audio.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},length:t.length||0,roomType:t.roomType,file_length:t.file_length,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},r.file=function(e){this.id=e,this.type="file",this.body={}},r.file.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},r.video=function(e){},r.video.prototype.set=function(e){};var o=function(e){if(!this instanceof o)return new o(e,conn);this.msg=e};o.prototype.send=function(t){var n=this,r=function(n){n.ext=n.ext||{},n.ext.weichat=n.ext.weichat||{},n.ext.weichat.originType=n.ext.weichat.originType||"webim";var r,o={from:t.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}},i=e.stringify(o);if(r=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(i),n.roomType&&r.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),n.bodyId){r=$msg({from:t.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.bodyId);var s={xmlns:"urn:xmpp:receipts",id:n.bodyId};r.up().c("delivery",s)}if(n.ackId){if(t.context.jid.indexOf(n.toJid)>=0)return;r=$msg({from:t.context.jid||"",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(n.ackId);var a={xmlns:"urn:xmpp:receipts",id:n.ackId};r.up().c("acked",a)}setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[n.id]&&_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)},6e4),t.sendCommand(r.tree(),n.id)};if(n.msg.file){if(n.msg.body&&n.msg.body.url)return void r(n.msg);var o=n.msg.onFileUploadComplete,i=function(e){if(e.entities[0]["file-metadata"]){var i=e.entities[0]["file-metadata"]["content-length"];n.msg.filetype=e.entities[0]["file-metadata"]["content-type"],i>204800&&(n.msg.thumbnail=!0)}n.msg.body={type:n.msg.type||"file",url:("https:"!=location.protocol&&t.isHttpDNS?t.apiUrl+e.uri.substr(e.uri.indexOf("/",9)):e.uri)+"/"+e.entities[0].uuid,secret:e.entities[0]["share-secret"],filename:n.msg.file.filename||n.msg.filename,size:{width:n.msg.width||0,height:n.msg.height||0},length:n.msg.length||0,file_length:n.msg.ext.file_length||0,filetype:n.msg.filetype},r(n.msg),o instanceof Function&&o(e,n.msg.id)};n.msg.onFileUploadComplete=i,e.uploadFile.call(t,n.msg)}else n.msg.body={type:"chat"===n.msg.type?"txt":n.msg.type,msg:n.msg.msg},"cmd"===n.msg.type?n.msg.body.action=n.msg.action:"loc"===n.msg.type&&(n.msg.body.addr=n.msg.addr,n.msg.body.lat=n.msg.lat,n.msg.body.lng=n.msg.lng),r(n.msg)},t._msg=o,t.message=r}()},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43))}(0,function(e){return e})},function(e,t,n){!function(n,r){e.exports=t=r()}(0,function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},o=r.lib={},i=o.Base=function(){return{extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=s<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],o=0;o<t;o+=4){var i=function(t){var t=t,n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,t=18e3*(65535&t)+(t>>16)&r;var o=(n<<16)+t&r;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}}(4294967296*(n||e.random()));n=987654071*i(),r.push(4294967296*i()|0)}return new s.init(r,t)}}),a=r.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},l=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=4*i,c=o/a;c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0);var u=c*i,l=e.min(4*u,o);if(u){for(var h=0;h<u;h+=i)this._doProcessBlock(r,h);var d=r.splice(0,u);n.sigBytes-=l}return new s.init(d,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(o.Hasher=h.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math);return e})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(t){var n=e,r=n.lib,o=r.Base,i=r.WordArray,s=n.x64={};s.Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),e})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(){if("function"==typeof ArrayBuffer){var t=e,n=t.lib,r=n.WordArray,o=r.init;(r.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,n=[],r=0;r<t;r++)n[r>>>2]|=e[r]<<24-r%4*8;o.call(this,n,t)}else o.apply(this,arguments)}).prototype=r}}(),e.lib.WordArray})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(){function t(e){return e<<8&4278255360|e>>>8&16711935}var n=e,r=n.lib,o=r.WordArray,i=n.enc;i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o+=2){var i=t[o>>>2]>>>16-o%4*8&65535;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return o.create(n,2*t)}};i.Utf16LE={stringify:function(e){for(var n=e.words,r=e.sigBytes,o=[],i=0;i<r;i+=2){var s=t(n[i>>>2]>>>16-i%4*8&65535);o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var n=e.length,r=[],i=0;i<n;i++)r[i>>>1]|=t(e.charCodeAt(i)<<16-i%2*16);return o.create(r,2*n)}}}(),e.enc.Utf16})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(){function t(e,t,n){for(var r=[],i=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,c=n[e.charCodeAt(s)]>>>6-s%4*2;r[i>>>2]|=(a|c)<<24-i%4*8,i++}return o.create(r,i)}var n=e,r=n.lib,o=r.WordArray,i=n.enc;i.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var s=t[i>>>2]>>>24-i%4*8&255,a=t[i+1>>>2]>>>24-(i+1)%4*8&255,c=t[i+2>>>2]>>>24-(i+2)%4*8&255,u=s<<16|a<<8|c,l=0;l<4&&i+.75*l<n;l++)o.push(r.charAt(u>>>6*(3-l)&63));var h=r.charAt(64);if(h)for(;o.length%4;)o.push(h);return o.join("")},parse:function(e){var n=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(n=a)}return t(e,n,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(t){function n(e,t,n,r,o,i,s){var a=e+(t&n|~t&r)+o+s;return(a<<i|a>>>32-i)+t}function r(e,t,n,r,o,i,s){var a=e+(t&r|n&~r)+o+s;return(a<<i|a>>>32-i)+t}function o(e,t,n,r,o,i,s){var a=e+(t^n^r)+o+s;return(a<<i|a>>>32-i)+t}function i(e,t,n,r,o,i,s){var a=e+(n^(t|~r))+o+s;return(a<<i|a>>>32-i)+t}var s=e,a=s.lib,c=a.WordArray,u=a.Hasher,l=s.algo,h=[];!function(){for(var e=0;e<64;e++)h[e]=4294967296*t.abs(t.sin(e+1))|0}();var d=l.MD5=u.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var a=t+s,c=e[a];e[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var u=this._hash.words,l=e[t+0],d=e[t+1],p=e[t+2],f=e[t+3],m=e[t+4],_=e[t+5],g=e[t+6],y=e[t+7],v=e[t+8],N=e[t+9],b=e[t+10],E=e[t+11],S=e[t+12],T=e[t+13],x=e[t+14],C=e[t+15],I=u[0],O=u[1],w=u[2],R=u[3];I=n(I,O,w,R,l,7,h[0]),R=n(R,I,O,w,d,12,h[1]),w=n(w,R,I,O,p,17,h[2]),O=n(O,w,R,I,f,22,h[3]),I=n(I,O,w,R,m,7,h[4]),R=n(R,I,O,w,_,12,h[5]),w=n(w,R,I,O,g,17,h[6]),O=n(O,w,R,I,y,22,h[7]),I=n(I,O,w,R,v,7,h[8]),R=n(R,I,O,w,N,12,h[9]),w=n(w,R,I,O,b,17,h[10]),O=n(O,w,R,I,E,22,h[11]),I=n(I,O,w,R,S,7,h[12]),R=n(R,I,O,w,T,12,h[13]),w=n(w,R,I,O,x,17,h[14]),O=n(O,w,R,I,C,22,h[15]),I=r(I,O,w,R,d,5,h[16]),R=r(R,I,O,w,g,9,h[17]),w=r(w,R,I,O,E,14,h[18]),O=r(O,w,R,I,l,20,h[19]),I=r(I,O,w,R,_,5,h[20]),R=r(R,I,O,w,b,9,h[21]),w=r(w,R,I,O,C,14,h[22]),O=r(O,w,R,I,m,20,h[23]),I=r(I,O,w,R,N,5,h[24]),R=r(R,I,O,w,x,9,h[25]),w=r(w,R,I,O,f,14,h[26]),O=r(O,w,R,I,v,20,h[27]),I=r(I,O,w,R,T,5,h[28]),R=r(R,I,O,w,p,9,h[29]),w=r(w,R,I,O,y,14,h[30]),O=r(O,w,R,I,S,20,h[31]),I=o(I,O,w,R,_,4,h[32]),R=o(R,I,O,w,v,11,h[33]),w=o(w,R,I,O,E,16,h[34]),O=o(O,w,R,I,x,23,h[35]),I=o(I,O,w,R,d,4,h[36]),R=o(R,I,O,w,m,11,h[37]),w=o(w,R,I,O,y,16,h[38]),O=o(O,w,R,I,b,23,h[39]),I=o(I,O,w,R,T,4,h[40]),R=o(R,I,O,w,l,11,h[41]),w=o(w,R,I,O,f,16,h[42]),O=o(O,w,R,I,g,23,h[43]),I=o(I,O,w,R,N,4,h[44]),R=o(R,I,O,w,S,11,h[45]),w=o(w,R,I,O,C,16,h[46]),O=o(O,w,R,I,p,23,h[47]),I=i(I,O,w,R,l,6,h[48]),R=i(R,I,O,w,y,10,h[49]),w=i(w,R,I,O,x,15,h[50]),O=i(O,w,R,I,_,21,h[51]),I=i(I,O,w,R,S,6,h[52]),R=i(R,I,O,w,f,10,h[53]),w=i(w,R,I,O,b,15,h[54]),O=i(O,w,R,I,d,21,h[55]),I=i(I,O,w,R,v,6,h[56]),R=i(R,I,O,w,C,10,h[57]),w=i(w,R,I,O,g,15,h[58]),O=i(O,w,R,I,T,21,h[59]),I=i(I,O,w,R,m,6,h[60]),R=i(R,I,O,w,E,10,h[61]),w=i(w,R,I,O,p,15,h[62]),O=i(O,w,R,I,N,21,h[63]),u[0]=u[0]+I|0,u[1]=u[1]+O|0,u[2]=u[2]+w|0,u[3]=u[3]+R|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var i=t.floor(r/4294967296),s=r;n[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});s.MD5=u._createHelper(d),s.HmacMD5=u._createHmacHelper(d)}(Math),e.MD5})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(){var t=e,n=t.lib,r=n.WordArray,o=n.Hasher,i=t.algo,s=[],a=i.SHA1=o.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],c=n[4],u=0;u<80;u++){if(u<16)s[u]=0|e[t+u];else{var l=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=l<<1|l>>>31}var h=(r<<5|r>>>27)+c+s[u];h+=u<20?1518500249+(o&i|~o&a):u<40?1859775393+(o^i^a):u<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,c=a,a=i,i=o<<30|o>>>2,o=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=o._createHelper(a),t.HmacSHA1=o._createHmacHelper(a)}(),e.SHA1})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(t){var n=e,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.algo,a=[],c=[];!function(){function e(e){return 4294967296*(e-(0|e))|0}for(var n=2,r=0;r<64;)(function(e){for(var n=t.sqrt(e),r=2;r<=n;r++)if(!(e%r))return!1;return!0})(n)&&(r<8&&(a[r]=e(t.pow(n,.5))),c[r]=e(t.pow(n,1/3)),r++),n++}();var u=[],l=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],l=n[5],h=n[6],d=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var f=u[p-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,_=u[p-2],g=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;u[p]=m+u[p-7]+g+u[p-16]}var y=a&l^~a&h,v=r&o^r&i^o&i,N=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),E=d+b+y+c[p]+u[p],S=N+v;d=h,h=l,l=a,a=s+E|0,s=i,i=o,o=r,r=E+S|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+h|0,n[7]=n[7]+d|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=t.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=i._createHelper(l),n.HmacSHA256=i._createHmacHelper(l)}(Math),e.SHA256})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(18))}(0,function(e){return function(){var t=e,n=t.lib,r=n.WordArray,o=t.algo,i=o.SHA256,s=o.SHA224=i.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=4,e}});t.SHA224=i._createHelper(s),t.HmacSHA224=i._createHmacHelper(s)}(),e.SHA224})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(12))}(0,function(e){return function(){function t(){return s.create.apply(s,arguments)}var n=e,r=n.lib,o=r.Hasher,i=n.x64,s=i.Word,a=i.WordArray,c=n.algo,u=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],l=[];!function(){for(var e=0;e<80;e++)l[e]=t()}();var h=c.SHA512=o.extend({_doReset:function(){this._hash=new a.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],c=n[5],h=n[6],d=n[7],p=r.high,f=r.low,m=o.high,_=o.low,g=i.high,y=i.low,v=s.high,N=s.low,b=a.high,E=a.low,S=c.high,T=c.low,x=h.high,C=h.low,I=d.high,O=d.low,w=p,R=f,A=m,M=_,B=g,D=y,k=v,j=N,L=b,F=E,H=S,U=T,W=x,q=C,G=I,P=O,J=0;J<80;J++){var z=l[J];if(J<16)var X=z.high=0|e[t+2*J],$=z.low=0|e[t+2*J+1];else{var Q=l[J-15],K=Q.high,V=Q.low,Y=(K>>>1|V<<31)^(K>>>8|V<<24)^K>>>7,Z=(V>>>1|K<<31)^(V>>>8|K<<24)^(V>>>7|K<<25),ee=l[J-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=l[J-7],se=ie.high,ae=ie.low,ce=l[J-16],ue=ce.high,le=ce.low,$=Z+ae,X=Y+se+($>>>0<Z>>>0?1:0),$=$+oe,X=X+re+($>>>0<oe>>>0?1:0),$=$+le,X=X+ue+($>>>0<le>>>0?1:0);z.high=X,z.low=$}var he=L&H^~L&W,de=F&U^~F&q,pe=w&A^w&B^A&B,fe=R&M^R&D^M&D,me=(w>>>28|R<<4)^(w<<30|R>>>2)^(w<<25|R>>>7),_e=(R>>>28|w<<4)^(R<<30|w>>>2)^(R<<25|w>>>7),ge=(L>>>14|F<<18)^(L>>>18|F<<14)^(L<<23|F>>>9),ye=(F>>>14|L<<18)^(F>>>18|L<<14)^(F<<23|L>>>9),ve=u[J],Ne=ve.high,be=ve.low,Ee=P+ye,Se=G+ge+(Ee>>>0<P>>>0?1:0),Ee=Ee+de,Se=Se+he+(Ee>>>0<de>>>0?1:0),Ee=Ee+be,Se=Se+Ne+(Ee>>>0<be>>>0?1:0),Ee=Ee+$,Se=Se+X+(Ee>>>0<$>>>0?1:0),Te=_e+fe,xe=me+pe+(Te>>>0<_e>>>0?1:0);G=W,P=q,W=H,q=U,H=L,U=F,F=j+Ee|0,L=k+Se+(F>>>0<j>>>0?1:0)|0,k=B,j=D,B=A,D=M,A=w,M=R,R=Ee+Te|0,w=Se+xe+(R>>>0<Ee>>>0?1:0)|0}f=r.low=f+R,r.high=p+w+(f>>>0<R>>>0?1:0),_=o.low=_+M,o.high=m+A+(_>>>0<M>>>0?1:0),y=i.low=y+D,i.high=g+B+(y>>>0<D>>>0?1:0),N=s.low=N+j,s.high=v+k+(N>>>0<j>>>0?1:0),E=a.low=E+F,a.high=b+L+(E>>>0<F>>>0?1:0),T=c.low=T+U,c.high=S+H+(T>>>0<U>>>0?1:0),C=h.low=C+q,h.high=x+W+(C>>>0<q>>>0?1:0),O=d.low=O+P,d.high=I+G+(O>>>0<P>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});n.SHA512=o._createHelper(h),n.HmacSHA512=o._createHmacHelper(h)}(),e.SHA512})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(12),n(20))}(0,function(e){return function(){var t=e,n=t.x64,r=n.Word,o=n.WordArray,i=t.algo,s=i.SHA512,a=i.SHA384=s.extend({_doReset:function(){this._hash=new o.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=16,e}});t.SHA384=s._createHelper(a),t.HmacSHA384=s._createHmacHelper(a)}(),e.SHA384})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(12))}(0,function(e){return function(t){var n=e,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.x64,a=s.Word,c=n.algo,u=[],l=[],h=[];!function(){for(var e=1,t=0,n=0;n<24;n++){u[e+5*t]=(n+1)*(n+2)/2%64;var r=t%5,o=(2*e+3*t)%5;e=r,t=o}for(var e=0;e<5;e++)for(var t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,s=0;s<24;s++){for(var c=0,d=0,p=0;p<7;p++){if(1&i){var f=(1<<p)-1;f<32?d^=1<<f:c^=1<<f-32}128&i?i=i<<1^113:i<<=1}h[s]=a.create(c,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=a.create()}();var p=c.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,o=0;o<r;o++){var i=e[t+2*o],s=e[t+2*o+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8);var a=n[o];a.high^=s,a.low^=i}for(var c=0;c<24;c++){for(var p=0;p<5;p++){for(var f=0,m=0,_=0;_<5;_++){var a=n[p+5*_];f^=a.high,m^=a.low}var g=d[p];g.high=f,g.low=m}for(var p=0;p<5;p++)for(var y=d[(p+4)%5],v=d[(p+1)%5],N=v.high,b=v.low,f=y.high^(N<<1|b>>>31),m=y.low^(b<<1|N>>>31),_=0;_<5;_++){var a=n[p+5*_];a.high^=f,a.low^=m}for(var E=1;E<25;E++){var a=n[E],S=a.high,T=a.low,x=u[E];if(x<32)var f=S<<x|T>>>32-x,m=T<<x|S>>>32-x;else var f=T<<x-32|S>>>64-x,m=S<<x-32|T>>>64-x;var C=d[l[E]];C.high=f,C.low=m}var I=d[0],O=n[0];I.high=O.high,I.low=O.low;for(var p=0;p<5;p++)for(var _=0;_<5;_++){var E=p+5*_,a=n[E],w=d[E],R=d[(p+1)%5+5*_],A=d[(p+2)%5+5*_];a.high=w.high^~R.high&A.high,a.low=w.low^~R.low&A.low}var a=n[0],M=h[c];a.high^=M.high,a.low^=M.low}},_doFinalize:function(){var e=this._data,n=e.words,r=(this._nDataBytes,8*e.sigBytes),i=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(t.ceil((r+1)/i)*i>>>5)-1]|=128,e.sigBytes=4*n.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],l=0;l<c;l++){var h=s[l],d=h.high,p=h.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),u.push(p),u.push(d)}return new o.init(u,a)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});n.SHA3=i._createHelper(p),n.HmacSHA3=i._createHmacHelper(p)}(Math),e.SHA3})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){return function(t){function n(e,t,n){return e^t^n}function r(e,t,n){return e&t|~e&n}function o(e,t,n){return(e|~t)^n}function i(e,t,n){return e&n|t&~n}function s(e,t,n){return e^(t|~n)}function a(e,t){return e<<t|e>>>32-t}var c=e,u=c.lib,l=u.WordArray,h=u.Hasher,d=c.algo,p=l.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),f=l.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),m=l.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),_=l.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),g=l.create([0,1518500249,1859775393,2400959708,2840853838]),y=l.create([1352829926,1548603684,1836072691,2053994217,0]),v=d.RIPEMD160=h.extend({_doReset:function(){this._hash=l.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var c=0;c<16;c++){var u=t+c,l=e[u];e[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var h,d,v,N,b,E,S,T,x,C,I=this._hash.words,O=g.words,w=y.words,R=p.words,A=f.words,M=m.words,B=_.words;E=h=I[0],S=d=I[1],T=v=I[2],x=N=I[3],C=b=I[4];for(var D,c=0;c<80;c+=1)D=h+e[t+R[c]]|0,D+=c<16?n(d,v,N)+O[0]:c<32?r(d,v,N)+O[1]:c<48?o(d,v,N)+O[2]:c<64?i(d,v,N)+O[3]:s(d,v,N)+O[4],D|=0,D=a(D,M[c]),D=D+b|0,h=b,b=N,N=a(v,10),v=d,d=D,D=E+e[t+A[c]]|0,D+=c<16?s(S,T,x)+w[0]:c<32?i(S,T,x)+w[1]:c<48?o(S,T,x)+w[2]:c<64?r(S,T,x)+w[3]:n(S,T,x)+w[4],D|=0,D=a(D,B[c]),D=D+C|0,E=C,C=x,x=a(T,10),T=S,S=D;D=I[1]+v+x|0,I[1]=I[2]+N+C|0,I[2]=I[3]+b+E|0,I[3]=I[4]+h+S|0,I[4]=I[0]+d+T|0,I[0]=D},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=this._hash,i=o.words,s=0;s<5;s++){var a=i[s];i[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return o},clone:function(){var e=h.clone.call(this);return e._hash=this._hash.clone(),e}});c.RIPEMD160=h._createHelper(v),c.HmacRIPEMD160=h._createHmacHelper(v)}(Math),e.RIPEMD160})},function(e,t,n){!function(r,o){e.exports=t=o(n(11))}(0,function(e){!function(){var t=e,n=t.lib,r=n.Base,o=t.enc,i=o.Utf8,s=t.algo;s.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,c=s.words,u=0;u<n;u++)a[u]^=1549556828,c[u]^=909522486;o.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}()})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(17),n(24))}(0,function(e){return function(){var t=e,n=t.lib,r=n.Base,o=n.WordArray,i=t.algo,s=i.SHA1,a=i.HMAC,c=i.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=a.create(n.hasher,e),i=o.create(),s=o.create([1]),c=i.words,u=s.words,l=n.keySize,h=n.iterations;c.length<l;){var d=r.update(t).finalize(s);r.reset();for(var p=d.words,f=p.length,m=d,_=1;_<h;_++){m=r.finalize(m),r.reset();for(var g=m.words,y=0;y<f;y++)p[y]^=g[y]}i.concat(d),u[0]++}return i.sigBytes=4*l,i}});t.PBKDF2=function(e,t,n){return c.create(n).compute(e,t)}}(),e.PBKDF2})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(17),n(24))}(0,function(e){return function(){var t=e,n=t.lib,r=n.Base,o=n.WordArray,i=t.algo,s=i.MD5,a=i.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=n.hasher.create(),i=o.create(),s=i.words,a=n.keySize,c=n.iterations;s.length<a;){u&&r.update(u);var u=r.update(e).finalize(t);r.reset();for(var l=1;l<c;l++)u=r.finalize(u),r.reset();i.concat(u)}return i.sigBytes=4*a,i}});t.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)}}(),e.EvpKDF})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(26))}(0,function(e){e.lib.Cipher||function(t){var n=e,r=n.lib,o=r.Base,i=r.WordArray,s=r.BufferedBlockAlgorithm,a=n.enc,c=(a.Utf8,a.Base64),u=n.algo,l=u.EvpKDF,h=r.Cipher=s.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?S:N}return function(t){return{encrypt:function(n,r,o){return e(r).encrypt(t,n,r,o)},decrypt:function(n,r,o){return e(r).decrypt(t,n,r,o)}}}}()}),d=(r.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),n.mode={}),p=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=d.CBC=function(){function e(e,n,r){var o=this._iv;if(o){var i=o;this._iv=t}else var i=this._prevBlock;for(var s=0;s<r;s++)e[n+s]^=i[s]}var n=p.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize;e.call(this,t,n,o),r.encryptBlock(t,n),this._prevBlock=t.slice(n,n+o)}}),n.Decryptor=n.extend({processBlock:function(t,n){var r=this._cipher,o=r.blockSize,i=t.slice(n,n+o);r.decryptBlock(t,n),e.call(this,t,n,o),this._prevBlock=i}}),n}(),m=n.pad={},_=m.Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,o=r<<24|r<<16|r<<8|r,s=[],a=0;a<r;a+=4)s.push(o);var c=i.create(s,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:_}),reset:function(){h.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var r=n.createEncryptor;else{var r=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==r?this._mode.init(this,t&&t.words):(this._mode=r.call(n,this,t&&t.words),this._mode.__creator=r)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=n.format={},v=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var r=i.create([1398893684,1701076831]).concat(n).concat(t);else var r=t;return r.toString(c)},parse:function(e){var t=c.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){
var r=i.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return g.create({ciphertext:t,salt:r})}},N=r.SerializableCipher=o.extend({cfg:o.extend({format:v}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r),i=o.finalize(t),s=o.cfg;return g.create({ciphertext:i,key:n,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=n.kdf={},E=b.OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));var o=l.create({keySize:t+n}).compute(e,r),s=i.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:s,salt:r})}},S=r.PasswordBasedCipher=N.extend({cfg:N.cfg.extend({kdf:E}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=r.kdf.execute(n,e.keySize,e.ivSize);r.iv=o.iv;var i=N.encrypt.call(this,e,t,o.key,r);return i.mixIn(o),i},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var o=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);return r.iv=o.iv,N.decrypt.call(this,e,t,o.key,r)}})}()})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.mode.CFB=function(){function t(e,t,n,r){var o=this._iv;if(o){var i=o.slice(0);this._iv=void 0}else var i=this._prevBlock;r.encryptBlock(i,0);for(var s=0;s<n;s++)e[t+s]^=i[s]}var n=e.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(e,n){var r=this._cipher,o=r.blockSize;t.call(this,e,n,o,r),this._prevBlock=e.slice(n,n+o)}}),n.Decryptor=n.extend({processBlock:function(e,n){var r=this._cipher,o=r.blockSize,i=e.slice(n,n+o);t.call(this,e,n,o,r),this._prevBlock=i}}),n}(),e.mode.CFB})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.mode.CTR=function(){var t=e.lib.BlockCipherMode.extend(),n=t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=this._iv,i=this._counter;o&&(i=this._counter=o.slice(0),this._iv=void 0);var s=i.slice(0);n.encryptBlock(s,0),i[r-1]=i[r-1]+1|0;for(var a=0;a<r;a++)e[t+a]^=s[a]}});return t.Decryptor=n,t}(),e.mode.CTR})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.mode.CTRGladman=function(){function t(e){if(255==(e>>24&255)){var t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}function n(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var r=e.lib.BlockCipherMode.extend(),o=r.Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,o=r.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0),n(s);var a=s.slice(0);r.encryptBlock(a,0);for(var c=0;c<o;c++)e[t+c]^=a[c]}});return r.Decryptor=o,r}(),e.mode.CTRGladman})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.mode.OFB=function(){var t=e.lib.BlockCipherMode.extend(),n=t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,o=this._iv,i=this._keystream;o&&(i=this._keystream=o.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var s=0;s<r;s++)e[t+s]^=i[s]}});return t.Decryptor=n,t}(),e.mode.OFB})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.mode.ECB=function(){var t=e.lib.BlockCipherMode.extend();return t.Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t}(),e.mode.ECB})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,o=r-n%r,i=n+o-1;e.clamp(),e.words[i>>>2]|=o<<24-i%4*8,e.sigBytes+=o},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.pad.Iso10126={pad:function(t,n){var r=4*n,o=r-t.sigBytes%r;t.concat(e.lib.WordArray.random(o-1)).concat(e.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.pad.Iso97971={pad:function(t,n){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,n)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},e.pad.ZeroPadding})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(27))}(0,function(e){return function(t){var n=e,r=n.lib,o=r.CipherParams,i=n.enc,s=i.Hex,a=n.format;a.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return o.create({ciphertext:t})}}}(),e.format.Hex})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(15),n(16),n(26),n(27))}(0,function(e){return function(){var t=e,n=t.lib,r=n.BlockCipher,o=t.algo,i=[],s=[],a=[],c=[],u=[],l=[],h=[],d=[],p=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var n=0,r=0,t=0;t<256;t++){var o=r^r<<1^r<<2^r<<3^r<<4;o=o>>>8^255&o^99,i[n]=o,s[o]=n;var m=e[n],_=e[m],g=e[_],y=257*e[o]^16843008*o;a[n]=y<<24|y>>>8,c[n]=y<<16|y>>>16,u[n]=y<<8|y>>>24,l[n]=y;var y=16843009*g^65537*_^257*m^16843008*n;h[o]=y<<24|y>>>8,d[o]=y<<16|y>>>16,p[o]=y<<8|y>>>24,f[o]=y,n?(n=m^e[e[e[g^m]]],r^=e[e[r]]):n=r=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],_=o.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=this._nRounds=n+6,o=4*(r+1),s=this._keySchedule=[],a=0;a<o;a++)if(a<n)s[a]=t[a];else{var c=s[a-1];a%n?n>6&&a%n==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=c<<8|c>>>24,c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=m[a/n|0]<<24),s[a]=s[a-n]^c}for(var u=this._invKeySchedule=[],l=0;l<o;l++){var a=o-l;if(l%4)var c=s[a];else var c=s[a-4];u[l]=l<4||a<=4?c:h[i[c>>>24]]^d[i[c>>>16&255]]^p[i[c>>>8&255]]^f[i[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,c,u,l,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,h,d,p,f,s);var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,s,a){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],p=4,f=1;f<c;f++){var m=r[u>>>24]^o[l>>>16&255]^i[h>>>8&255]^s[255&d]^n[p++],_=r[l>>>24]^o[h>>>16&255]^i[d>>>8&255]^s[255&u]^n[p++],g=r[h>>>24]^o[d>>>16&255]^i[u>>>8&255]^s[255&l]^n[p++],y=r[d>>>24]^o[u>>>16&255]^i[l>>>8&255]^s[255&h]^n[p++];u=m,l=_,h=g,d=y}var m=(a[u>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[p++],_=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&u])^n[p++],g=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[u>>>8&255]<<8|a[255&l])^n[p++],y=(a[d>>>24]<<24|a[u>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[p++];e[t]=m,e[t+1]=_,e[t+2]=g,e[t+3]=y},keySize:8});t.AES=r._createHelper(_)}(),e.AES})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(15),n(16),n(26),n(27))}(0,function(e){return function(){function t(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function n(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}var r=e,o=r.lib,i=o.WordArray,s=o.BlockCipher,a=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],p=a.DES=s.extend({_doReset:function(){for(var e=this._key,t=e.words,n=[],r=0;r<56;r++){var o=c[r]-1;n[r]=t[o>>>5]>>>31-o%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){for(var a=i[s]=[],h=l[s],r=0;r<24;r++)a[r/6|0]|=n[(u[r]-1+h)%28]<<31-r%6,a[4+(r/6|0)]|=n[28+(u[r+24]-1+h)%28]<<31-r%6;a[0]=a[0]<<1|a[0]>>>31;for(var r=1;r<7;r++)a[r]=a[r]>>>4*(r-1)+3;a[7]=a[7]<<5|a[7]>>>27}for(var d=this._invSubKeys=[],r=0;r<16;r++)d[r]=i[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,r,o){this._lBlock=e[r],this._rBlock=e[r+1],t.call(this,4,252645135),t.call(this,16,65535),n.call(this,2,858993459),n.call(this,8,16711935),t.call(this,1,1431655765);for(var i=0;i<16;i++){for(var s=o[i],a=this._lBlock,c=this._rBlock,u=0,l=0;l<8;l++)u|=h[l][((c^s[l])&d[l])>>>0];this._lBlock=c,this._rBlock=a^u}var p=this._lBlock;this._lBlock=this._rBlock,this._rBlock=p,t.call(this,1,1431655765),n.call(this,8,16711935),n.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),e[r]=this._lBlock,e[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});r.DES=s._createHelper(p);var f=a.TripleDES=s.extend({_doReset:function(){var e=this._key,t=e.words;this._des1=p.createEncryptor(i.create(t.slice(0,2))),this._des2=p.createEncryptor(i.create(t.slice(2,4))),this._des3=p.createEncryptor(i.create(t.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});r.TripleDES=s._createHelper(f)}(),e.TripleDES})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(15),n(16),n(26),n(27))}(0,function(e){return function(){function t(){for(var e=this._S,t=this._i,n=this._j,r=0,o=0;o<4;o++){t=(t+1)%256,n=(n+e[t])%256;var i=e[t];e[t]=e[n],e[n]=i,r|=e[(e[t]+e[n])%256]<<24-8*o}return this._i=t,this._j=n,r}var n=e,r=n.lib,o=r.StreamCipher,i=n.algo,s=i.RC4=o.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],o=0;o<256;o++)r[o]=o;for(var o=0,i=0;o<256;o++){var s=o%n,a=t[s>>>2]>>>24-s%4*8&255;i=(i+r[o]+a)%256;var c=r[o];r[o]=r[i],r[i]=c}this._i=this._j=0},_doProcessBlock:function(e,n){e[n]^=t.call(this)},keySize:8,ivSize:0});n.RC4=o._createHelper(s);var a=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)t.call(this)}});n.RC4Drop=o._createHelper(a)}(),e.RC4})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(15),n(16),n(26),n(27))}(0,function(e){return function(){function t(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var r=e[n]+t[n],o=65535&r,i=r>>>16,s=((o*o>>>17)+o*i>>>15)+i*i,u=((4294901760&r)*r|0)+((65535&r)*r|0);c[n]=s^u}e[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,e[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,e[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,e[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,e[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,e[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,e[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,e[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=e,r=n.lib,o=r.StreamCipher,i=n.algo,s=[],a=[],c=[],u=i.Rabbit=o.extend({_doReset:function(){for(var e=this._key.words,n=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)t.call(this);for(var r=0;r<8;r++)i[r]^=o[r+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),h=u>>>16|4294901760&l,d=l<<16|65535&u;i[0]^=u,i[1]^=h,i[2]^=l,i[3]^=d,i[4]^=u,i[5]^=h,i[6]^=l,i[7]^=d;for(var r=0;r<4;r++)t.call(this)}},_doProcessBlock:function(e,n){var r=this._X;t.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var o=0;o<4;o++)s[o]=16711935&(s[o]<<8|s[o]>>>24)|4278255360&(s[o]<<24|s[o]>>>8),e[n+o]^=s[o]},blockSize:4,ivSize:2});n.Rabbit=o._createHelper(u)}(),e.Rabbit})},function(e,t,n){!function(r,o,i){e.exports=t=o(n(11),n(15),n(16),n(26),n(27))}(0,function(e){return function(){function t(){for(var e=this._X,t=this._C,n=0;n<8;n++)a[n]=t[n];t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0;for(var n=0;n<8;n++){var r=e[n]+t[n],o=65535&r,i=r>>>16,s=((o*o>>>17)+o*i>>>15)+i*i,u=((4294901760&r)*r|0)+((65535&r)*r|0);c[n]=s^u}e[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,e[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,e[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,e[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,e[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,e[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,e[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,e[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}var n=e,r=n.lib,o=r.StreamCipher,i=n.algo,s=[],a=[],c=[],u=i.RabbitLegacy=o.extend({_doReset:function(){var e=this._key.words,n=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)t.call(this);for(var i=0;i<8;i++)o[i]^=r[i+4&7];if(n){var s=n.words,a=s[0],c=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),h=u>>>16|4294901760&l,d=l<<16|65535&u;o[0]^=u,o[1]^=h,o[2]^=l,o[3]^=d,o[4]^=u,o[5]^=h,o[6]^=l,o[7]^=d;for(var i=0;i<4;i++)t.call(this)}},_doProcessBlock:function(e,n){var r=this._X;t.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var o=0;o<4;o++)s[o]=16711935&(s[o]<<8|s[o]>>>24)|4278255360&(s[o]<<24|s[o]>>>8),e[n+o]^=s[o]},blockSize:4,ivSize:2});n.RabbitLegacy=o._createHelper(u)}(),e.RabbitLegacy})},function(e,t){!function(){function e(e){this.array=void 0===e?[]:new Array(e)}e.prototype={length:function(){return this.array.length},at:function(e){return this.array[e]},set:function(e,t){this.array[e]=t},push:function(e){return this.array.push(e)},slice:function(e,t){return this.array=this.array.slice(e,t)},concat:function(e){this.array=this.array.concat(e)},remove:function(e,t){t=void 0===t?1:t,this.array.splice(e,t)},join:function(e){return this.array.join(e)},clear:function(){this.array.length=0}};var n=function(){this._array_h=new e};n.prototype={_index:0,push:function(e){this._array_h.push(e)},pop:function(){var e=null;return this._array_h.length()&&(e=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),e},head:function(){var e=null,t=this._array_h.length();return t&&(e=this._array_h.at(t-1)),e},tail:function(){var e=null;return this._array_h.length()&&(e=this._array_h.at(this._index)),e},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},t.Queue=n}()},function(e,t,n){(function(t){!function(t,n){e.exports=n()}(0,function(){function e(t){return t instanceof e?t:this instanceof e?void(this._wrapped=t):new e(t)}function n(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,i){return e.call(t,n,r,o,i)}}return function(){return e.apply(t,arguments)}}function r(e,t,r){return null==e?Ae:Ut(e)?n(e,t,r):Te(e)&&!Ft(e)?je(e):De(e)}function o(e,t){return r(e,t,1/0)}function i(t,n,i){return e.iteratee!==o?e.iteratee(t,n):r(t,n,i)}function s(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),o=0;o<n;o++)r[o]=arguments[o+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var i=Array(t+1);for(o=0;o<t;o++)i[o]=arguments[o];return i[t]=r,e.apply(this,i)}}function a(e){if(!Te(e))return{};if(nt)return nt(e);it.prototype=e;var t=new it;return it.prototype=null,t}function c(e){return function(t){return null==t?void 0:t[e]}}function u(e,t){return null!=e&&Ze.call(e,t)}function l(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function h(e){var t=ct(e);return"number"==typeof t&&t>=0&&t<=at}function d(e,t,r){t=n(t,r);var o,i;if(h(e))for(o=0,i=e.length;o<i;o++)t(e[o],o,e);else{var s=oe(e);for(o=0,i=s.length;o<i;o++)t(e[s[o]],s[o],e)}return e}function p(e,t,n){t=i(t,n);for(var r=!h(e)&&oe(e),o=(r||e).length,s=Array(o),a=0;a<o;a++){var c=r?r[a]:a;s[a]=t(e[c],c,e)}return s}function f(e){var t=function(t,n,r,o){var i=!h(t)&&oe(t),s=(i||t).length,a=e>0?0:s-1;for(o||(r=t[i?i[a]:a],a+=e);a>=0&&a<s;a+=e){var c=i?i[a]:a;r=n(r,t[c],c,t)}return r};return function(e,r,o,i){var s=arguments.length>=3;return t(e,n(r,i,4),o,s)}}function m(e,t,n){var r=h(e)?bt:de,o=r(e,t,n);if(void 0!==o&&-1!==o)return e[o]}function _(e,t,n){var r=[];return t=i(t,n),d(e,function(e,n,o){t(e,n,o)&&r.push(e)}),r}function g(e,t,n){return _(e,Z(i(t)),n)}function y(e,t,n){t=i(t,n);for(var r=!h(e)&&oe(e),o=(r||e).length,s=0;s<o;s++){var a=r?r[s]:s;if(!t(e[a],a,e))return!1}return!0}function v(e,t,n){t=i(t,n);for(var r=!h(e)&&oe(e),o=(r||e).length,s=0;s<o;s++){var a=r?r[s]:s;if(t(e[a],a,e))return!0}return!1}function N(e,t,n,r){return h(e)||(e=se(e)),("number"!=typeof n||r)&&(n=0),St(e,t,n)>=0}function b(e,t){return p(e,De(t))}function E(e,t){return _(e,je(t))}function S(e,t){return m(e,je(t))}function T(e,t,n){var r,o,s=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e){e=h(e)?e:se(e);for(var c=0,u=e.length;c<u;c++)null!=(r=e[c])&&r>s&&(s=r)}else t=i(t,n),d(e,function(e,n,r){((o=t(e,n,r))>a||o===-1/0&&s===-1/0)&&(s=e,a=o)});return s}function x(e,t,n){var r,o,s=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e){e=h(e)?e:se(e);for(var c=0,u=e.length;c<u;c++)null!=(r=e[c])&&r<s&&(s=r)}else t=i(t,n),d(e,function(e,n,r){((o=t(e,n,r))<a||o===1/0&&s===1/0)&&(s=e,a=o)});return s}function C(e){return I(e,1/0)}function I(e,t,n){if(null==t||n)return h(e)||(e=se(e)),e[Fe(e.length-1)];var r=h(e)?me(e):se(e),o=ct(r);t=Math.max(Math.min(t,o),0);for(var i=o-1,s=0;s<t;s++){var a=Fe(s,i),c=r[s];r[s]=r[a],r[a]=c}return r.slice(0,t)}function O(e,t,n){var r=0;return t=i(t,n),b(p(e,function(e,n,o){return{value:e,index:r++,criteria:t(e,n,o)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")}function w(e,t){return function(n,r,o){var s=t?[[],[]]:{};return r=i(r,o),d(n,function(t,o){var i=r(t,o,n);e(s,t,i)}),s}}function R(e){return e?Ft(e)?Ve.call(e):Wt(e)?e.match(mt):h(e)?p(e,Ae):se(e):[]}function A(e){return null==e?0:h(e)?e.length:oe(e).length}function M(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:B(e,e.length-t)}function B(e,t,n){return Ve.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function D(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:k(e,Math.max(0,e.length-t))}function k(e,t,n){return Ve.call(e,null==t||n?1:t)}function j(e){return _(e,Boolean)}function L(e,t,n,r){r=r||[];for(var o=r.length,i=0,s=ct(e);i<s;i++){var a=e[i];if(h(a)&&(Ft(a)||Ht(a)))if(t)for(var c=0,u=a.length;c<u;)r[o++]=a[c++];else L(a,t,n,r),o=r.length;else n||(r[o++]=a)}return r}function F(e,t){return L(e,t,!1)}function H(e,t,n,r){Ie(t)||(r=n,n=t,t=!1),null!=n&&(n=i(n,r));for(var o=[],s=[],a=0,c=ct(e);a<c;a++){var u=e[a],l=n?n(u,a,e):u;t&&!n?(a&&s===l||o.push(u),s=l):n?N(s,l)||(s.push(l),o.push(u)):N(o,u)||o.push(u)}return o}function U(e){for(var t=[],n=arguments.length,r=0,o=ct(e);r<o;r++){var i=e[r];if(!N(t,i)){var s;for(s=1;s<n&&N(arguments[s],i);s++);s===n&&t.push(i)}}return t}function W(e){for(var t=e&&T(e,ct).length||0,n=Array(t),r=0;r<t;r++)n[r]=b(e,r);return n}function q(e,t){for(var n={},r=0,o=ct(e);r<o;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n}function G(e){return function(t,n,r){n=i(n,r);for(var o=ct(t),s=e>0?0:o-1;s>=0&&s<o;s+=e)if(n(t[s],s,t))return s;return-1}}function P(e,t,n,r){n=i(n,r,1);for(var o=n(t),s=0,a=ct(e);s<a;){var c=Math.floor((s+a)/2);n(e[c])<o?s=c+1:a=c}return s}function J(e,t,n){return function(r,o,i){var s=0,a=ct(r);if("number"==typeof i)e>0?s=i>=0?i:Math.max(i+a,s):a=i>=0?Math.min(i+1,a):i+a+1;else if(n&&i&&a)return i=n(r,o),r[i]===o?i:-1;if(o!==o)return i=t(Ve.call(r,s,a),Ce),i>=0?i+s:-1;for(i=e>0?s:a-1;i>=0&&i<a;i+=e)if(r[i]===o)return i;return-1}}function z(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),o=Array(r),i=0;i<r;i++,e+=n)o[i]=e;return o}function X(e,t){if(null==t||t<1)return[];for(var n=[],r=0,o=e.length;r<o;)n.push(Ve.call(e,r,r+=t));return n}function $(e,t,n,r,o){if(!(r instanceof t))return e.apply(n,o);var i=a(e.prototype),s=e.apply(i,o);return Te(s)?s:i}function Q(e,t){var n=function(r){var o=n.cache,i=""+(t?t.apply(this,arguments):r);return u(o,i)||(o[i]=e.apply(this,arguments)),o[i]};return n.cache={},n}function K(e,t,n){var r,o,i,s,a=0;n||(n={});var c=function(){a=!1===n.leading?0:Yt(),r=null,s=e.apply(o,i),r||(o=i=null)},u=function(){var u=Yt();a||!1!==n.leading||(a=u);var l=t-(u-a);return o=this,i=arguments,l<=0||l>t?(r&&(clearTimeout(r),r=null),a=u,s=e.apply(o,i),r||(o=i=null)):r||!1===n.trailing||(r=setTimeout(c,l)),s};return u.cancel=function(){clearTimeout(r),a=0,r=o=i=null},u}function V(e,t,n){var r,o,i=function(t,n){r=null,n&&(o=e.apply(t,n))},a=s(function(s){if(r&&clearTimeout(r),n){var a=!r;r=setTimeout(i,t),a&&(o=e.apply(this,s))}else r=Ot(i,t,this,s);return o});return a.cancel=function(){clearTimeout(r),r=null},a}function Y(e,t){return Ct(t,e)}function Z(e){return function(){return!e.apply(this,arguments)}}function ee(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}}function te(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function ne(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}function re(e,t){var n=Mt.length,r=e.constructor,o=Ut(r)&&r.prototype||$e,i="constructor";for(u(e,i)&&!N(t,i)&&t.push(i);n--;)(i=Mt[n])in e&&e[i]!==o[i]&&!N(t,i)&&t.push(i)}function oe(e){if(!Te(e))return[];if(tt)return tt(e);var t=[];for(var n in e)u(e,n)&&t.push(n);return At&&re(e,t),t}function ie(e){if(!Te(e))return[];var t=[];for(var n in e)t.push(n);return At&&re(e,t),t}function se(e){for(var t=oe(e),n=t.length,r=Array(n),o=0;o<n;o++)r[o]=e[t[o]];return r}function ae(e,t,n){t=i(t,n);for(var r=oe(e),o=r.length,s={},a=0;a<o;a++){var c=r[a];s[c]=t(e[c],c,e)}return s}function ce(e){for(var t=oe(e),n=t.length,r=Array(n),o=0;o<n;o++)r[o]=[t[o],e[t[o]]];return r}function ue(e){for(var t={},n=oe(e),r=0,o=n.length;r<o;r++)t[e[n[r]]]=n[r];return t}function le(e){var t=[];for(var n in e)Ut(e[n])&&t.push(n);return t.sort()}function he(e,t){
return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var o=1;o<r;o++)for(var i=arguments[o],s=e(i),a=s.length,c=0;c<a;c++){var u=s[c];t&&void 0!==n[u]||(n[u]=i[u])}return n}}function de(e,t,n){t=i(t,n);for(var r,o=oe(e),s=0,a=o.length;s<a;s++)if(r=o[s],t(e[r],r,e))return r}function pe(e,t,n){return t in n}function fe(e,t){var n=a(e);return t&&Dt(n,t),n}function me(e){return Te(e)?Ft(e)?e.slice():Bt({},e):e}function _e(e,t){return t(e),e}function ge(e,t){var n=oe(t),r=n.length;if(null==e)return!r;for(var o=Object(e),i=0;i<r;i++){var s=n[i];if(t[s]!==o[s]||!(s in o))return!1}return!0}function ye(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!==e)return t!==t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&ve(e,t,n,r)}function ve(t,n,r,o){t instanceof e&&(t=t._wrapped),n instanceof e&&(n=n._wrapped);var i=Ye.call(t);if(i!==Ye.call(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/+t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return Qe.valueOf.call(t)===Qe.valueOf.call(n)}var s="[object Array]"===i;if(!s){if("object"!=typeof t||"object"!=typeof n)return!1;var a=t.constructor,c=n.constructor;if(a!==c&&!(Ut(a)&&a instanceof a&&Ut(c)&&c instanceof c)&&"constructor"in t&&"constructor"in n)return!1}r=r||[],o=o||[];for(var l=r.length;l--;)if(r[l]===t)return o[l]===n;if(r.push(t),o.push(n),s){if((l=t.length)!==n.length)return!1;for(;l--;)if(!ye(t[l],n[l],r,o))return!1}else{var h,d=oe(t);if(l=d.length,oe(n).length!==l)return!1;for(;l--;)if(h=d[l],!u(n,h)||!ye(t[h],n[h],r,o))return!1}return r.pop(),o.pop(),!0}function Ne(e,t){return ye(e,t)}function be(e){return null==e||(h(e)&&(Ft(e)||Wt(e)||Ht(e))?0===e.length:0===oe(e).length)}function Ee(e){return!(!e||1!==e.nodeType)}function Se(e){return function(t){return Ye.call(t)==="[object "+e+"]"}}function Te(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function xe(e){return!zt(e)&&ot(e)&&!rt(parseFloat(e))}function Ce(e){return qt(e)&&rt(e)}function Ie(e){return!0===e||!1===e||"[object Boolean]"===Ye.call(e)}function Oe(e){return null===e}function we(e){return void 0===e}function Re(e,t){if(!Ft(t))return u(e,t);for(var n=t.length,r=0;r<n;r++){var o=t[r];if(null==e||!Ze.call(e,o))return!1;e=e[o]}return!!n}function Ae(e){return e}function Me(e){return function(){return e}}function Be(){}function De(e){return Ft(e)?function(t){return l(t,e)}:c(e)}function ke(e){return null==e?function(){}:function(t){return Ft(t)?l(e,t):e[t]}}function je(e){return e=Dt({},e),function(t){return ge(t,e)}}function Le(e,t,r){var o=Array(Math.max(0,e));t=n(t,r,1);for(var i=0;i<e;i++)o[i]=t(i);return o}function Fe(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}function He(e){var t=function(t){return e[t]},n="(?:"+oe(e).join("|")+")",r=RegExp(n),o=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(o,t):e}}function Ue(e,t,n){Ft(t)||(t=[t]);var r=t.length;if(!r)return Ut(n)?n.call(e):n;for(var o=0;o<r;o++){var i=null==e?void 0:e[t[o]];void 0===i&&(i=n,o=r),e=Ut(i)?i.call(e):i}return e}function We(e){var t=++rn+"";return e?e+t:t}function qe(t,n,r){!n&&r&&(n=r),n=Lt({},n,e.templateSettings);var o=RegExp([(n.escape||sn).source,(n.interpolate||sn).source,(n.evaluate||sn).source].join("|")+"|$","g"),i=0,s="__p+='";t.replace(o,function(e,n,r,o,a){return s+=t.slice(i,a).replace(cn,un),i=a+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),e}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";var a;try{a=new Function(n.variable||"obj","_",s)}catch(e){throw e.source=s,e}var c=function(t){return a.call(this,t,e)};return c.source="function("+(n.variable||"obj")+"){\n"+s+"}",c}function Ge(t){var n=e(t);return n._chain=!0,n}function Pe(t,n){return t._chain?e(n).chain():n}function Je(t){return d(le(t),function(n){var r=e[n]=t[n];e.prototype[n]=function(){var t=[this._wrapped];return Ke.apply(t,arguments),Pe(this,r.apply(e,t))}}),e}var ze="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||Function("return this")()||{},Xe=Array.prototype,$e=Object.prototype,Qe="undefined"!=typeof Symbol?Symbol.prototype:null,Ke=Xe.push,Ve=Xe.slice,Ye=$e.toString,Ze=$e.hasOwnProperty,et=Array.isArray,tt=Object.keys,nt=Object.create,rt=ze.isNaN,ot=ze.isFinite,it=function(){},st=e.VERSION="1.10.2";e.iteratee=o;var at=Math.pow(2,53)-1,ct=c("length"),ut=f(1),lt=f(-1),ht=s(function(e,t,n){var r,o;return Ut(t)?o=t:Ft(t)&&(r=t.slice(0,-1),t=t[t.length-1]),p(e,function(e){var i=o;if(!i){if(r&&r.length&&(e=l(e,r)),null==e)return;i=e[t]}return null==i?i:i.apply(e,n)})}),dt=w(function(e,t,n){u(e,n)?e[n].push(t):e[n]=[t]}),pt=w(function(e,t,n){e[n]=t}),ft=w(function(e,t,n){u(e,n)?e[n]++:e[n]=1}),mt=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g,_t=w(function(e,t,n){e[n?0:1].push(t)},!0),gt=s(function(e,t){return vt(e,t)}),yt=s(function(e){return H(L(e,!0,!0))}),vt=s(function(e,t){return t=L(t,!0,!0),_(e,function(e){return!N(t,e)})}),Nt=s(W),bt=G(1),Et=G(-1),St=J(1,bt,P),Tt=J(-1,Et),xt=s(function(e,t,n){if(!Ut(e))throw new TypeError("Bind must be called on a function");var r=s(function(o){return $(e,r,t,this,n.concat(o))});return r}),Ct=s(function(e,t){var n=Ct.placeholder,r=function(){for(var o=0,i=t.length,s=Array(i),a=0;a<i;a++)s[a]=t[a]===n?arguments[o++]:t[a];for(;o<arguments.length;)s.push(arguments[o++]);return $(e,r,this,this,s)};return r});Ct.placeholder=e;var It=s(function(e,t){t=L(t,!1,!1);var n=t.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=xt(e[r],e)}}),Ot=s(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),wt=Ct(Ot,e,1),Rt=Ct(ne,2),At=!{toString:null}.propertyIsEnumerable("toString"),Mt=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Bt=he(ie),Dt=he(oe),kt=s(function(e,t){var r={},o=t[0];if(null==e)return r;Ut(o)?(t.length>1&&(o=n(o,t[1])),t=ie(e)):(o=pe,t=L(t,!1,!1),e=Object(e));for(var i=0,s=t.length;i<s;i++){var a=t[i],c=e[a];o(c,a,e)&&(r[a]=c)}return r}),jt=s(function(e,t){var n,r=t[0];return Ut(r)?(r=Z(r),t.length>1&&(n=t[1])):(t=p(L(t,!1,!1),String),r=function(e,n){return!N(t,n)}),kt(e,r,n)}),Lt=he(ie,!0),Ft=et||Se("Array"),Ht=Se("Arguments"),Ut=Se("Function"),Wt=Se("String"),qt=Se("Number"),Gt=Se("Date"),Pt=Se("RegExp"),Jt=Se("Error"),zt=Se("Symbol"),Xt=Se("Map"),$t=Se("WeakMap"),Qt=Se("Set"),Kt=Se("WeakSet");!function(){Ht(arguments)||(Ht=function(e){return u(e,"callee")})}();var Vt=ze.document&&ze.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Vt&&(Ut=function(e){return"function"==typeof e||!1});var Yt=Date.now||function(){return(new Date).getTime()},Zt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},en=ue(Zt),tn=He(Zt),nn=He(en),rn=0,on=e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},sn=/(.)^/,an={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},cn=/\\|'|\r|\n|\u2028|\u2029/g,un=function(e){return"\\"+an[e]};d(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=Xe[t];e.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],Pe(this,e)}}),d(["concat","join","slice"],function(t){var n=Xe[t];e.prototype[t]=function(){return Pe(this,n.apply(this._wrapped,arguments))}}),e.prototype.value=function(){return this._wrapped},e.prototype.valueOf=e.prototype.toJSON=e.prototype.value,e.prototype.toString=function(){return String(this._wrapped)};var ln={default:e,VERSION:st,iteratee:o,restArguments:s,each:d,forEach:d,map:p,collect:p,reduce:ut,foldl:ut,inject:ut,reduceRight:lt,foldr:lt,find:m,detect:m,filter:_,select:_,reject:g,every:y,all:y,some:v,any:v,contains:N,includes:N,include:N,invoke:ht,pluck:b,where:E,findWhere:S,max:T,min:x,shuffle:C,sample:I,sortBy:O,groupBy:dt,indexBy:pt,countBy:ft,toArray:R,size:A,partition:_t,first:M,head:M,take:M,initial:B,last:D,rest:k,tail:k,drop:k,compact:j,flatten:F,without:gt,uniq:H,unique:H,union:yt,intersection:U,difference:vt,unzip:W,zip:Nt,object:q,findIndex:bt,findLastIndex:Et,sortedIndex:P,indexOf:St,lastIndexOf:Tt,range:z,chunk:X,bind:xt,partial:Ct,bindAll:It,memoize:Q,delay:Ot,defer:wt,throttle:K,debounce:V,wrap:Y,negate:Z,compose:ee,after:te,before:ne,once:Rt,keys:oe,allKeys:ie,values:se,mapObject:ae,pairs:ce,invert:ue,functions:le,methods:le,extend:Bt,extendOwn:Dt,assign:Dt,findKey:de,pick:kt,omit:jt,defaults:Lt,create:fe,clone:me,tap:_e,isMatch:ge,isEqual:Ne,isEmpty:be,isElement:Ee,isArray:Ft,isObject:Te,isArguments:Ht,isFunction:Ut,isString:Wt,isNumber:qt,isDate:Gt,isRegExp:Pt,isError:Jt,isSymbol:zt,isMap:Xt,isWeakMap:$t,isSet:Qt,isWeakSet:Kt,isFinite:xe,isNaN:Ce,isBoolean:Ie,isNull:Oe,isUndefined:we,has:Re,identity:Ae,constant:Me,noop:Be,property:De,propertyOf:ke,matcher:je,matches:je,times:Le,random:Fe,now:Yt,escape:tn,unescape:nn,result:Ue,uniqueId:We,templateSettings:on,template:qe,chain:Ge,mixin:Je},hn=Je(ln);return hn._=hn,hn})}).call(t,function(){return this}())}])});